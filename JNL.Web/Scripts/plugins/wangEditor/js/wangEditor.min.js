(function(n){typeof define=="function"?window.define.amd?window.define("wangEditor",["jquery"],n):window.define.cmd?window.define(function(){return n}):n(window.jQuery):typeof module=="object"&&typeof module.exports=="object"?module.exports=n(require("./wangEditor-jquery.js")):n(window.jQuery)})(function(n){if(!n||!n.fn||!n.fn.jquery){alert("在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor");return}var t=function(t){var i=window.wangEditor;i&&t(i,n)};return function(n,t){if(n.wangEditor){alert("一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！");return}var i=function(n){var i=t("#"+n),r;i.length===1&&(r=i[0].nodeName,r==="TEXTAREA"||r==="DIV")&&(this.valueNodeName=r.toLowerCase(),this.$valueContainer=i,this.$prev=i.prev(),this.$parent=i.parent(),this.init())};i.fn=i.prototype;i.$body=t("body");i.$document=t(document);i.$window=t(n);i.userAgent=navigator.userAgent;i.getComputedStyle=n.getComputedStyle;i.w3cRange=typeof document.createRange=="function";i.hostname=location.hostname.toLowerCase();i.websiteHost="wangeditor.github.io";i.isOnWebsite=i.hostname===i.websiteHost;i.docsite="http://www.kancloud.cn/wangfupeng/wangeditor2/113961";n.wangEditor=i;i.plugin=function(n){i._plugins||(i._plugins=[]);typeof n=="function"&&i._plugins.push(n)}}(window,n),t(function(n){n.fn.init=function(){this.initDefaultConfig();this.addEditorContainer();this.addTxt();this.addMenuContainer();this.menus={};this.commandHooks()}}),t(function(n,t){n.fn.ready=function(n){this.readyFns||(this.readyFns=[]);this.readyFns.push(n)};n.fn.readyHeadler=function(){for(var n=this.readyFns;n.length;)n.shift().call(this)};n.fn.updateValue=function(){var n=this,t=n.$valueContainer,i=n.txt.$txt,r;t!==i&&(r=i.html(),t.val(r))};n.fn.getInitValue=function(){var t=this,i=t.$valueContainer,n="",r=t.valueNodeName;return r==="div"?n=i.html():r==="textarea"&&(n=i.val()),n};n.fn.updateMenuStyle=function(){var n=this.menus;t.each(n,function(n,t){t.updateSelected()})};n.fn.enableMenusExcept=function(n){this._disabled||(n=n||[],typeof n=="string"&&(n=[n]),t.each(this.menus,function(t,i){n.indexOf(t)>=0||i.disabled(!1)}))};n.fn.disableMenusExcept=function(n){this._disabled||(n=n||[],typeof n=="string"&&(n=[n]),t.each(this.menus,function(t,i){n.indexOf(t)>=0||i.disabled(!0)}))};n.fn.hideDropPanelAndModal=function(){var n=this.menus;t.each(n,function(n,t){var i=t.dropPanel||t.dropList||t.modal;i&&i.hide&&i.hide()})}}),t(function(n,t){function r(){}var i=!n.w3cRange;n.fn.currentRange=function(n){if(n)this._rangeData=n;else return this._rangeData};n.fn.collapseRange=function(n,t){t=t||"end";t=t==="start"?!0:!1;n=n||this.currentRange();n&&(n.collapse(t),this.currentRange(n))};n.fn.getRangeText=i?r:function(n){if(n=n||this.currentRange(),n)return n.toString()};n.fn.getRangeElem=i?r:function(n){n=n||this.currentRange();var t=n.commonAncestorContainer;return t.nodeType===1?t:t.parentNode};n.fn.isRangeEmpty=i?r:function(n){return(n=n||this.currentRange(),n&&n.startContainer&&n.startContainer===n.endContainer&&n.startOffset===n.endOffset)?!0:!1};n.fn.saveSelection=i?r:function(n){var u=this,i,r,f=u.txt.$txt.get(0);n?i=n.commonAncestorContainer:(r=document.getSelection(),r.getRangeAt&&r.rangeCount&&(n=document.getSelection().getRangeAt(0),i=n.commonAncestorContainer));i&&(t.contains(f,i)||f===i)&&u.currentRange(n)};n.fn.restoreSelection=i?r:function(t){var i;if(t=t||this.currentRange(),t)try{i=document.getSelection();i.removeAllRanges();i.addRange(t)}catch(r){n.error("执行 editor.restoreSelection 时，IE可能会有异常，不影响使用")}};n.fn.restoreSelectionByElem=i?r:function(n,t){n&&(t=t||"end",this.setRangeByElem(n),t==="start"&&this.collapseRange(this.currentRange(),"start"),t==="end"&&this.collapseRange(this.currentRange(),"end"),this.restoreSelection())};n.fn.initSelection=i?r:function(){var n=this,i,t;n.currentRange()||(i=n.txt.$txt,t=i.children().first(),t.length&&n.restoreSelectionByElem(t.get(0)))};n.fn.setRangeByElem=i?r:function(n){var f=this,e=f.txt.$txt.get(0),r,i,u;if(n&&t.contains(e,n)){for(r=n.firstChild;r;){if(r.nodeType===3)break;r=r.firstChild}for(i=n.lastChild;i;){if(i.nodeType===3)break;i=i.lastChild}u=document.createRange();r&&i?(u.setStart(r,0),u.setEnd(i,i.textContent.length)):(u.setStart(n,0),u.setEnd(n,0));f.saveSelection(u)}}}),t(function(n,t){n.w3cRange||(n.fn.getRangeText=function(n){if(n=n||this.currentRange(),n)return n.text},n.fn.getRangeElem=function(n){if(n=n||this.currentRange(),n){var t=n.parentElement();return t.nodeType===1?t:t.parentNode}},n.fn.isRangeEmpty=function(n){return(n=n||this.currentRange(),n&&n.text)?!1:!0},n.fn.saveSelection=function(n){var r=this,i,u=r.txt.$txt.get(0);n?i=n.parentElement():(n=document.selection.createRange(),i=typeof n.parentElement=="undefined"?null:n.parentElement());i&&(t.contains(u,i)||u===i)&&r.currentRange(n)},n.fn.restoreSelection=function(n){var i=this,t;if(n=n||i.currentRange(),n){t=document.selection.createRange();try{t.setEndPoint("EndToEnd",n)}catch(r){}if(n.text.length===0)try{t.collapse(!1)}catch(r){}else t.setEndPoint("StartToStart",n);t.select()}})}),t(function(n,t){n.fn.commandHooks=function(){var n=this,i={};i.insertHtml=function(i){var u=t(i),f=n.getRangeElem(),r;(r=n.getLegalTags(f),r)&&t(r).after(u)};n.commandHooks=i}}),t(function(n){n.fn.command=function(n,t,i,r){function e(){t&&(f.queryCommandSupported(t)?document.execCommand(t,!1,i):(u=f.commandHooks,t in u&&u[t](i)))}var f=this,u;this.customCommand(n,e,r)};n.fn.commandForElem=function(n,t,i,r,u){var e,o,f;typeof n=="string"?e=n:(e=n.selector,o=n.check);f=this.getRangeElem();f=this.getSelfOrParentByName(f,e,o);f&&this.setRangeByElem(f);this.command(t,i,r,u)};n.fn.customCommand=function(n,t,i){function f(){r.hideDropPanelAndModal()}var r=this,u=r.currentRange();if(!u){n&&n.preventDefault();return}r.undoRecord();this.restoreSelection(u);t.call(r);this.saveSelection();this.restoreSelection();i&&typeof i=="function"&&i.call(r);r.txt.insertEmptyP();r.txt.wrapImgAndText();r.updateValue();r.updateMenuStyle();setTimeout(f,200);n&&n.preventDefault()};n.fn.queryCommandValue=function(n){var t="";try{t=document.queryCommandValue(n)}catch(i){}return t};n.fn.queryCommandState=function(n){var t=!1;try{t=document.queryCommandState(n)}catch(i){}return t};n.fn.queryCommandSupported=function(n){var t=!1;try{t=document.queryCommandSupported(n)}catch(i){}return t}}),t(function(n,t){function r(n){var r=this,u=t(n),i=!1;return u.each(function(){if(this===r)return i=!0,!1}),i}var i;n.fn.getLegalTags=function(t){var i=this.config.legalTags;if(!i){n.error("配置项中缺少 legalTags 的配置");return}return this.getSelfOrParentByName(t,i)};n.fn.getSelfOrParentByName=function(n,u,f){if(n&&u){i||(i=n.webkitMatchesSelector||n.mozMatchesSelector||n.oMatchesSelector||n.matchesSelector);i||(i=r);for(var e=this.txt.$txt.get(0);n&&e!==n&&t.contains(e,n);){if(i.call(n,u)&&(!f||f(n)))return n;n=n.parentNode}return}}}),t(function(n){function r(n,t){var i=t.val,r=n.txt.$txt.html();i!=null&&i!==r&&(n.txt.$txt.html(i),n.updateValue())}var i=[],t=[],u=20;n.fn.undoRecord=function(){var n=this,f=n.txt.$txt,r=f.html(),e=t.length?t[0]:"";r!==e&&(i.length&&(i=[]),t.unshift({range:n.currentRange(),val:r}),t.length>u&&t.pop())};n.fn.undo=function(){if(t.length){var n=t.shift();i.unshift(n);r(this,n)}};n.fn.redo=function(){if(i.length){var n=i.shift();t.unshift(n);r(this,n)}}}),t(function(n,t){n.fn.create=function(){var i=this,r;i.addMenus();i.renderMenus();i.renderMenuContainer();i.renderTxt();i.renderEditorContainer();i.eventMenus();i.eventMenuContainer();i.eventTxt();i.readyHeadler();i.initSelection();r=n._plugins;r&&r.length&&t.each(r,function(n,t){t.call(i)});i.$txt=i.txt.$txt};n.fn.disable=function(){this.txt.$txt.removeAttr("contenteditable");this.disableMenusExcept();this._disabled=!0};n.fn.enable=function(){this._disabled=!1;this.txt.$txt.attr("contenteditable","true");this.enableMenusExcept()};n.fn.destroy=function(){var n=this,t=n.$valueContainer,i=n.$editorContainer,r=n.valueNodeName;r==="div"?(t.removeAttr("contenteditable"),i.after(t),i.hide()):(t.show(),i.hide())};n.fn.undestroy=function(){var n=this,t=n.$valueContainer,i=n.$editorContainer,r=n.menuContainer.$menuContainer,u=n.valueNodeName;u==="div"?(t.attr("contenteditable","true"),r.after(t),i.show()):(t.hide(),i.show())};n.fn.clear=function(){var n=this,t=n.txt.$txt;t.html("<p><br><\/p>");n.restoreSelectionByElem(t.find("p").get(0))}}),t(function(n){var t=function(n){this.editor=n;this.init()};t.fn=t.prototype;n.MenuContainer=t}),t(function(n,t){var i=n.MenuContainer;i.fn.init=function(){var n=this,i=t('<div class="wangEditor-menu-container clearfix"><\/div>');n.$menuContainer=i;n.changeShadow()};i.fn.changeShadow=function(){var n=this.$menuContainer,i=this.editor,t=i.txt.$txt;t.on("scroll",function(){t.scrollTop()>10?n.addClass("wangEditor-menu-shadow"):n.removeClass("wangEditor-menu-shadow")})}}),t(function(n,t){var i=n.MenuContainer;i.fn.render=function(){var n=this.$menuContainer,t=this.editor.$editorContainer;t.append(n)};i.fn.height=function(){var n=this.$menuContainer;return n.height()};i.fn.appendMenu=function(n,t){return this._addGroup(n),this._addOneMenu(t)};i.fn._addGroup=function(n){var r=this.$menuContainer,i;this.$currentGroup&&this.currentGroupIdx===n||(i=t('<div class="menu-group clearfix"><\/div>'),r.append(i),this.$currentGroup=i,this.currentGroupIdx=n)};i.fn._addOneMenu=function(n){var u=n.$domNormal,r=n.$domSelected,f=this.$currentGroup,i=t('<div class="menu-item clearfix"><\/div>');return r.hide(),i.append(u).append(r),f.append(i),i}}),t(function(n){var t=function(n){this.editor=n.editor;this.id=n.id;this.title=n.title;this.$domNormal=n.$domNormal;this.$domSelected=n.$domSelected||n.$domNormal;this.commandName=n.commandName;this.commandValue=n.commandValue;this.commandNameSelected=n.commandNameSelected||n.commandName;this.commandValueSelected=n.commandValueSelected||n.commandValue};t.fn=t.prototype;n.Menu=t}),t(function(n,t){var i=n.Menu;i.fn.initUI=function(){var f=this.editor,r=f.UI.menus,u=this.id,i=r[u];this.$domNormal&&this.$domSelected||(i==null&&(n.warn('editor.UI配置中，没有菜单 "'+u+'" 的UI配置，只能取默认值'),i=r["default"]),this.$domNormal=t(i.normal),this.$domSelected=/^\./.test(i.selected)?this.$domNormal.clone().addClass(i.selected.slice(1)):t(i.selected))}}),t(function(n,t){var i=n.Menu;i.fn.render=function(n){this.initUI();var i=this.editor,r=i.menuContainer,u=r.appendMenu(n,this),t=this.onRender;this._renderTip(u);t&&typeof t=="function"&&t.call(this)};i.fn._renderTip=function(i){function c(){r.show()}function s(){r.hide()}var u=this,h=u.editor,o=u.title,r=t('<div class="menu-tip"><\/div>'),f,e;u.tipWidth||(f=t('<p style="opacity:0; filter:Alpha(opacity=0); position:absolute;top:-10000px;">'+o+"<\/p>"),n.$body.append(f),h.ready(function(){var e=this,n=f.outerWidth()+5,t=r.outerWidth(),i=parseFloat(r.css("margin-left"),10);f.remove();f=null;r.css({width:n,"margin-left":i+(t-n)/2});u.tipWidth=n}));r.append(o);i.append(r);i.find("a").on("mouseenter",function(){u.active()||u.disabled()||(e=setTimeout(c,200))}).on("mouseleave",function(){e&&clearTimeout(e);s()}).on("click",s)};i.fn.bindEvent=function(){var t=this,u=t.$domNormal,f=t.$domSelected,i=t.clickEvent,r;i||(i=function(i){var r=t.dropPanel||t.dropList||t.modal,e,u,f,o;if(r&&r.show){r.isShowing?r.hide():r.show();return}e=t.editor;o=t.selected;o?(u=t.commandNameSelected,f=t.commandValueSelected):(u=t.commandName,f=t.commandValue);u?e.command(i,u,f):(n.warn('菜单 "'+t.id+'" 未定义click事件'),i.preventDefault())});r=t.clickEventSelected||i;u.click(function(n){t.disabled()||(i.call(t,n),t.updateSelected());n.preventDefault()});f.click(function(n){t.disabled()||(r.call(t,n),t.updateSelected());n.preventDefault()})};i.fn.updateSelected=function(){var n=this,r=n.editor,i=n.updateSelectedEvent,t;i||(i=function(){var n=this,t=n.editor,i=n.commandName,r=n.commandValue;if(r){if(t.queryCommandValue(i).toLowerCase()===r.toLowerCase())return!0}else if(t.queryCommandState(i))return!0;return!1});t=i.call(n);t=!!t;n.changeSelectedState(t)};i.fn.changeSelectedState=function(n){var t=this,i=t.selected;if(n!=null&&typeof n=="boolean"){if(i===n)return;t.selected=n;n?(t.$domNormal.hide(),t.$domSelected.show()):(t.$domNormal.show(),t.$domSelected.hide())}};i.fn.active=function(n){if(n==null)return this._activeState;this._activeState=n};i.fn.activeStyle=function(n){var r=this.selected,t=this.$domNormal,i=this.$domSelected;n?(t.addClass("active"),i.addClass("active")):(t.removeClass("active"),i.removeClass("active"));this.active(n)};i.fn.disabled=function(n){if(n==null)return!!this._disabled;if(this._disabled!==n){var t=this.$domNormal,i=this.$domSelected;n?(t.addClass("disable"),i.addClass("disable")):(t.removeClass("disable"),i.removeClass("disable"));this._disabled=n}}}),t(function(n){var t=function(n,t,i){this.editor=n;this.menu=t;this.data=i.data;this.tpl=i.tpl;this.selectorForELemCommand=i.selectorForELemCommand;this.init()};t.fn=t.prototype;n.DropList=t}),t(function(n,t){var i=n.DropList;i.fn.init=function(){var n=this;n.initDOM();n.bindEvent();n.initHideEvent()};i.fn.initDOM=function(){var n=this,f=n.data,e=n.tpl||"<span>{#title}<\/span>",r=t('<div class="wangEditor-drop-list clearfix"><\/div>'),u,i;t.each(f,function(n,f){u=e.replace(/{#commandValue}/ig,n).replace(/{#title}/ig,f);i=t('<a href="#" commandValue="'+n+'"><\/a>');i.append(u);r.append(i)});n.$list=r};i.fn.bindEvent=function(){var n=this,i=n.editor,r=n.menu,u=r.commandName,f=n.selectorForELemCommand,e=n.$list;e.on("click","a[commandValue]",function(n){var e=t(n.currentTarget).attr("commandValue");r.selected&&i.isRangeEmpty()&&f?i.commandForElem(f,n,u,e):i.command(n,u,e)})};i.fn.initHideEvent=function(){var i=this,r=i.$list.get(0);n.$body.on("click",function(n){if(i.isShowing){var u=n.target,f=i.menu,e;(e=f.selected?f.$domSelected.get(0):f.$domNormal.get(0),e===u||t.contains(e,u))||r===u||t.contains(r,u)||i.hide()}});n.$window.scroll(function(){i.hide()});n.$window.on("resize",function(){i.hide()})}}),t(function(n){var t=n.DropList;t.fn._render=function(){var n=this,t=n.editor,i=n.$list;t.$editorContainer.append(i);n.rendered=!0};t.fn._position=function(){var i=this,n=i.$list,r=i.editor,u=i.menu,o=r.menuContainer.$menuContainer,f=u.selected?u.$domSelected:u.$domNormal,s=f.offsetParent().position(),a=s.top,v=s.left,y=f.offsetParent().height(),h=f.offsetParent().width(),p=n.outerWidth(),w=r.txt.$txt.outerWidth(),t=a+y,c=v+h/2,e=0-h/2,l=c+p-w;l>-10&&(e=e-l-10);n.css({top:t,left:c,"margin-left":e});r._isMenufixed&&(t=t+(o.offset().top+o.outerHeight()-n.offset().top),n.css({top:t}))};t.fn.show=function(){var n=this,i=n.menu,t;(n.rendered||n._render(),n.isShowing)||(t=n.$list,t.show(),n._position(),n.isShowing=!0,i.activeStyle(!0))};t.fn.hide=function(){var n=this,i=n.menu,t;n.isShowing&&(t=n.$list,t.hide(),n.isShowing=!1,i.activeStyle(!1))}}),t(function(n){var t=function(n,t,i){this.editor=n;this.menu=t;this.$content=i.$content;this.width=i.width||200;this.height=i.height;this.onRender=i.onRender;this.init()};t.fn=t.prototype;n.DropPanel=t}),t(function(n,t){var i=n.DropPanel;i.fn.init=function(){var n=this;n.initDOM();n.initHideEvent()};i.fn.initDOM=function(){var n=this,f=n.$content,e=n.width,r=n.height,i=t('<div class="wangEditor-drop-panel clearfix"><\/div>'),u=t('<div class="tip-triangle"><\/div>');i.css({width:e,height:r?r:"auto"});i.append(u);i.append(f);n.$panel=i;n.$triangle=u};i.fn.initHideEvent=function(){var i=this,r=i.$panel.get(0);n.$body.on("click",function(n){if(i.isShowing){var u=n.target,f=i.menu,e;(e=f.selected?f.$domSelected.get(0):f.$domNormal.get(0),e===u||t.contains(e,u))||r===u||t.contains(r,u)||i.hide()}});n.$window.scroll(function(){i.hide()});n.$window.on("resize",function(){i.hide()})}}),t(function(n,t){var i=n.DropPanel;i.fn._render=function(){var n=this,t=n.onRender,i=n.editor,r=n.$panel;i.$editorContainer.append(r);t&&t.call(n);n.rendered=!0};i.fn._position=function(){var t=this,i=t.$panel,a=t.$triangle,f=t.editor,h=f.menuContainer.$menuContainer,e=t.menu,o=e.selected?e.$domSelected:e.$domNormal,c=o.offsetParent().position(),v=c.top,y=c.left,p=o.offsetParent().height(),w=o.offsetParent().width(),l=i.outerWidth(),b=f.txt.$txt.outerWidth(),r=v+p,u=y+w/2,n=0-l/2,k=n,s;0-n>u-10&&(n=10-u);s=u+l+n-b;s>-10&&(n=n-s-10);i.css({top:r,left:u,"margin-left":n});f._isMenufixed&&(r=r+(h.offset().top+h.outerHeight()-i.offset().top),i.css({top:r}));a.css({"margin-left":k-n-5})};i.fn.focusFirstInput=function(){var n=this,i=n.$panel;i.find("input[type=text],textarea").each(function(){var n=t(this);if(n.attr("disabled")==null)return n.focus(),!1})};i.fn.show=function(){var t=this,r=t.menu,i;(t.rendered||t._render(),t.isShowing)||(i=t.$panel,i.show(),t._position(),t.isShowing=!0,r.activeStyle(!0),n.w3cRange?t.focusFirstInput():n.placeholderForIE8(i))};i.fn.hide=function(){var n=this,i=n.menu,t;n.isShowing&&(t=n.$panel,t.hide(),n.isShowing=!1,i.activeStyle(!1))}}),t(function(n){var t=function(n,t,i){this.editor=n;this.menu=t;this.$content=i.$content;this.init()};t.fn=t.prototype;n.Modal=t}),t(function(n,t){var i=n.Modal;i.fn.init=function(){var n=this;n.initDom();n.initHideEvent()};i.fn.initDom=function(){var n=this,u=n.$content,i=t('<div class="wangEditor-modal"><\/div>'),r=t('<div class="wangEditor-modal-close"><i class="wangeditor-menu-img-cancel-circle"><\/i><\/div>');i.append(r);i.append(u);n.$modal=i;n.$close=r};i.fn.initHideEvent=function(){var i=this,u=i.$close,r=i.$modal.get(0);u.click(function(){i.hide()});n.$body.on("click",function(n){if(i.isShowing){var u=n.target,f=i.menu,e;f&&(e=f.selected?f.$domSelected.get(0):f.$domNormal.get(0),e===u||t.contains(e,u))||r===u||t.contains(r,u)||i.hide()}})}}),t(function(n){var t=n.Modal;t.fn._render=function(){var t=this,r=t.editor,i=t.$modal;i.css("z-index",r.config.zindex+10+"");n.$body.append(i);t.rendered=!0};t.fn._position=function(){var f=this,t=f.$modal,i=t.offset().top,e=t.outerWidth(),r=t.outerHeight(),o=0-e/2,u=0-r/2,s=n.$window.scrollTop();r/2>i&&(u=0-i);t.css({"margin-left":o+"px","margin-top":u+s+"px"})};t.fn.show=function(){var n=this,t=n.menu,i;(n.rendered||n._render(),n.isShowing)||(n.isShowing=!0,i=n.$modal,i.show(),n._position(),t&&t.activeStyle(!0))};t.fn.hide=function(){var n=this,t=n.menu,i;n.isShowing&&(n.isShowing=!1,i=n.$modal,i.hide(),t&&t.activeStyle(!1))}}),t(function(n){var t=function(n){this.editor=n;this.init()};t.fn=t.prototype;n.Txt=t}),t(function(n,t){var i=n.Txt;i.fn.init=function(){var n=this,r=n.editor,u=r.$valueContainer,f=r.getInitValue(),i;u.get(0).nodeName==="DIV"?(i=u,i.addClass("wangEditor-txt"),i.attr("contentEditable","true")):i=t('<div class="wangEditor-txt" contentEditable="true">'+f+"<\/div>");r.ready(function(){n.insertEmptyP()});n.$txt=i;n.contentEmptyHandle();n.bindEnterForDiv();n.bindEnterForText();n.bindTabEvent();n.bindPasteFilter();n.bindFormatText();n.bindHtml()};i.fn.contentEmptyHandle=function(){var r=this,u=r.editor,n=r.$txt,i;n.on("keyup",function(r){if(r.keyCode===8){var f=t.trim(n.html());f&&f!=="<br>"||(i=t("<p><br/><\/p>"),n.html(""),n.append(i),u.restoreSelectionByElem(i.get(0)))}})};i.fn.bindEnterForDiv=function(){function e(){if(i){var n=t("<p>"+i.html()+"<\/p>");i.after(n);i.remove()}}var o=n.config.legalTags,u=this,r=u.editor,f=u.$txt,i;f.on("keydown keyup",function(n){if(n.keyCode===13){var s=r.getRangeElem(),f=r.getLegalTags(s),u,o;if(!f){if(f=r.getSelfOrParentByName(s,"div"),!f)return;u=t(f);n.type==="keydown"&&(i=u,setTimeout(e,0));n.type==="keyup"&&(o=t("<p>"+u.html()+"<\/p>"),u.after(o),u.remove(),r.restoreSelectionByElem(o.get(0),"start"))}}})};i.fn.bindEnterForText=function(){var t=this,i=t.$txt,n;i.on("keyup",function(i){i.keyCode===13&&(n||(n=function(){t.wrapImgAndText()}),setTimeout(n))})};i.fn.bindTabEvent=function(){var n=this,t=n.editor,i=n.$txt;i.on("keydown",function(n){n.keyCode===9&&t.queryCommandSupported("insertHtml")&&t.command(n,"insertHtml","&nbsp;&nbsp;&nbsp;&nbsp;")})};i.fn.bindPasteFilter=function(){function f(r){if(r&&r.nodeType&&r.nodeName){var u,e=r.nodeName.toLowerCase(),o=r.nodeType;if(o===3||o===1){if(e==="div"){u=t(r);u.children().each(function(){f(this)});return}if(s.indexOf(e)>=0)n+=h(r);else if(o===3)n+="<p>"+r.textContent+"<\/p>";else{if(["meta","style","script","object","form","iframe"].indexOf(e)>=0)return;u=t(i(r));n+=t("<div>").append(u).html()}}}}function h(n){var r=n.nodeName.toLowerCase(),u,f="",e="";return["blockquote"].indexOf(r)>=0?(u=t(n),"<"+r+">"+u.text()+"<\/"+r+">"):["p","h1","h2","h3","h4","h5"].indexOf(r)>=0?(n=i(n),u=t(n),f=u.html(),f=f.replace(/<.*?>/ig,function(n){return n==="<\/a>"||n.indexOf("<a ")===0||n.indexOf("<img ")===0?n:""}),"<"+r+">"+f+"<\/"+r+">"):["ul","ol"].indexOf(r)>=0?(u=t(n),u.children().each(function(){var r=t(i(this)),n=r.html();n=n.replace(/<.*?>/ig,function(n){return n==="<\/a>"||n.indexOf("<a ")===0||n.indexOf("<img ")===0?n:""});e+="<li>"+n+"<\/li>"}),"<"+r+">"+e+"<\/"+r+">"):(u=t(i(n)),t("<div>").append(u).html())}function i(n){var f=n.attributes||[],u=[],e=["href","target","src","alt","rowspan","colspan"],r;return t.each(f,function(n,t){t&&t.nodeType===2&&u.push(t.nodeName)}),t.each(u,function(t,i){e.indexOf(i)<0&&n.removeAttribute(i)}),r=n.childNodes,r.length&&t.each(r,function(n,t){i(t)}),n}var u=this,r=u.editor,n="",e=u.$txt,o=r.config.legalTags,s=o.split(",");e.on("paste",function(i){var o,u,s,e;if(r.config.pasteFilter&&(o=r.getRangeElem().nodeName,o!=="TD"&&o!=="TH")){if(n="",e=i.clipboardData||i.originalEvent.clipboardData,e&&e.getData)u=e.getData("text/html"),u?(s=t("<div>"+u+"<\/div>"),f(s.get(0))):(u=e.getData("text/plain"),u&&(u=u.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<\/p><p>"),n="<p>"+u+"<\/p>",n=n.replace(/<p>(https?:\/\/.*?)<\/p>/ig,function(n,t){return'<p><a href="'+t+'" target="_blank">'+t+"<\/p>"})));else if(window.clipboardData&&window.clipboardData.getData){if(n=window.clipboardData.getData("text"),!n)return;n="<p>"+n+"<\/p>";n=n.replace((new RegExp("\n","g"),"<\/p><p>"))}else return;n&&r.command(i,"insertHtml",n)}})};i.fn.bindFormatText=function(){var r=this,o=r.editor,u=r.$txt,e=n.config.legalTags,f=e.split(","),s=f.length,i=[];t.each(f,function(n,t){var r=">\\s*<("+t+")>";i.push(new RegExp(r,"ig"))});i.push(new RegExp(">\\s*<(li)>","ig"));i.push(new RegExp(">\\s*<(tr)>","ig"));i.push(new RegExp(">\\s*<(code)>","ig"));u.formatText=function(){var r=t("<div>"),n=u.html();return n=n.replace(/\s*</ig,"<"),t.each(i,function(t,i){i.test(n)&&(n=n.replace(i,function(n,t){return">\n<"+t+">"}))}),r.html(n),r.text()}};i.fn.bindHtml=function(){var i=this,r=i.editor,n=i.$txt,u=r.$valueContainer,f=r.valueNodeName;n.html=function(i){var r;return f==="div"&&(r=t.fn.html.call(n,i)),i===undefined?r=t.fn.html.call(n):(r=t.fn.html.call(n,i),u.val(i)),i===undefined?r:void 0}}}),t(function(n,t){var i=n.Txt,r="propertychange change click keyup input paste";i.fn.render=function(){var n=this.$txt,t=this.editor.$editorContainer;t.append(n)};i.fn.initHeight=function(){var t=this.editor,u=this.$txt,i=t.$valueContainer.height(),r=t.menuContainer.height(),n=i-r;n=n<50?50:n;u.height(n);t.valueContainerHeight=i;this.initMaxHeight(n,r)};i.fn.initMaxHeight=function(n,i){var u=this.editor,o=u.menuContainer.$menuContainer,r=this.$txt,f=t("<div>"),e;if(window.getComputedStyle&&"max-height"in window.getComputedStyle(r.get(0))){if(e=parseInt(u.$valueContainer.css("max-height")),isNaN(e))return;u.useMaxHeight=!0;f.css({"max-height":e-i+"px","overflow-y":"auto"});r.css({height:"auto","overflow-y":"visible","min-height":n+"px"});f.on("scroll",function(){r.parent().scrollTop()>10?o.addClass("wangEditor-menu-shadow"):o.removeClass("wangEditor-menu-shadow")});r.wrap(f)}};i.fn.saveSelectionEvent=function(){function f(){i.saveSelection()}function e(){Date.now()-u<100||(u=Date.now(),f())}function o(){t&&clearTimeout(t);t=setTimeout(f,300)}var n=this.$txt,i=this.editor,t,u=Date.now();n.on(r+" focus blur",function(){e();o()});n.on("mousedown",function(){n.on("mouseleave.saveSelection",function(){e();o();i.updateMenuStyle()})}).on("mouseup",function(){n.off("mouseleave.saveSelection")})};i.fn.updateValueEvent=function(){function f(){var r=i.html();t!==r&&(n.onchange&&typeof n.onchange=="function"&&n.onchange.call(n),n.updateValue(),t=r)}var i=this.$txt,n=this.editor,u,t;i.on(r,function(){t==null&&(t=i.html());u&&clearTimeout(u);u=setTimeout(f,100)})};i.fn.updateMenuStyleEvent=function(){var n=this.$txt,t=this.editor;n.on(r,function(){t.updateMenuStyle()})};i.fn.insertEmptyP=function(){var n=this.$txt,i=n.children();if(i.length===0){n.append(t("<p><br><\/p>"));return}i.last().html()!=="<br>"&&n.append(t("<p><br><\/p>"))};i.fn.wrapImgAndText=function(){var r=this.$txt,u=r.children("img"),e=r[0],f=e.childNodes,o=f.length,i,n;for(u.length&&u.each(function(){t(this).wrap("<p>")}),i=0;i<o;i++)n=f[i],n.nodeType===3&&n.textContent&&t.trim(n.textContent)&&t(n).wrap("<p>")};i.fn.scrollTop=function(n){var t=this,r=t.editor,i=t.$txt;return r.useMaxHeight?i.parent().scrollTop(n):i.scrollTop(n)};i.fn.showHeightOnHover=function(){function o(t){n||(e.append(r),n=!0);var a=i.position().top,v=i.outerHeight(),u=t.height(),o=t.position().top,s=parseInt(t.css("margin-top"),10),h=parseInt(t.css("padding-top"),10),c=parseInt(t.css("margin-bottom"),10),l=parseInt(t.css("padding-bottom"),10),y=u+h+s+l+c,p=o+f.height();r.css({height:u+h+s+l+c,top:o+f.height()})}function s(){n&&(r.remove(),n=!1)}var u=this.editor,e=u.$editorContainer,f=u.menuContainer,i=this.$txt,r=t('<i class="height-tip"><i>'),n=!1;i.on("mouseenter","ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre",function(n){o(t(n.currentTarget))}).on("mouseleave",function(){s()})}}),t(function(n,t){Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]===n)return t;return-1},Array.prototype.lastIndexOf=function(n){for(var t=this.length,t=t-1;t>=0;t--)if(this[t]===n)return t;return-1});Date.now||(Date.now=function(){return(new Date).valueOf()});var i=window.console,r=function(){};t.each(["info","log","warn","error"],function(t,u){n[u]=i==null?r:function(t){n.config&&n.config.printLog&&i[u]("wangEditor提示: "+t)}});n.random=function(){return Math.random().toString().slice(2)};n.placeholder="placeholder"in document.createElement("input");n.placeholderForIE8=function(i){n.placeholder||i.find("input[placeholder]").each(function(){var n=t(this),i=n.attr("placeholder");if(n.val()===""){n.css("color","#666");n.val(i);n.on("focus.placeholder click.placeholder",function(){n.val("");n.css("color","#333");n.off("focus.placeholder click.placeholder")})}})}}),t(function(n){n.langs={};n.langs["zh-cn"]={bold:"粗体",underline:"下划线",italic:"斜体",forecolor:"文字颜色",bgcolor:"背景色",strikethrough:"删除线",eraser:"清空格式",source:"源码",quote:"引用",fontfamily:"字体",fontsize:"字号",head:"标题",orderlist:"有序列表",unorderlist:"无序列表",alignleft:"左对齐",aligncenter:"居中",alignright:"右对齐",link:"链接",text:"文本",submit:"提交",cancel:"取消",unlink:"取消链接",table:"表格",emotion:"表情",img:"图片",video:"视频",width:"宽",height:"高",location:"位置",loading:"加载中",searchlocation:"搜索位置",dynamicMap:"动态地图",clearLocation:"清除位置",langDynamicOneLocation:"动态地图只能显示一个位置",insertcode:"插入代码",undo:"撤销",redo:"重复",fullscreen:"全屏"};n.langs.en={bold:"Bold",underline:"Underline",italic:"Italic",forecolor:"Color",bgcolor:"Backcolor",strikethrough:"Strikethrough",eraser:"Eraser",source:"Codeview",quote:"Quote",fontfamily:"Font family",fontsize:"Font size",head:"Head",orderlist:"Ordered list",unorderlist:"Unordered list",alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",link:"Insert link",text:"Text",submit:"Submit",cancel:"Cancel",unlink:"Unlink",table:"Table",emotion:"Emotions",img:"Image",video:"Video",width:"width",height:"height",location:"Location",loading:"Loading",searchlocation:"search",dynamicMap:"Dynamic",clearLocation:"Clear",langDynamicOneLocation:"Only one location in dynamic map",insertcode:"Insert Code",undo:"Undo",redo:"Redo",fullscreen:"Full screnn"}}),t(function(n){n.config={};n.config.zindex=1e4;n.config.printLog=!0;n.config.menuFixed=0;n.config.jsFilter=!0;n.config.legalTags="p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre";n.config.lang=n.langs["zh-cn"];n.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","location","insertcode","|","undo","redo","fullscreen"];n.config.colors={"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"};n.config.familys=["宋体","黑体","楷体","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Microsoft JhengHei","Trebuchet MS","Courier New","Impact","Comic Sans MS"];n.config.fontsizes={1:"10px",2:"13px",3:"16px",4:"19px",5:"22px",6:"25px",7:"28px"};n.config.emotions={"default":{title:"默认",size:18,imgs:["/Scripts/plugs/wangEditor/static/emotions/default/1.gif","/Scripts/plugs/wangEditor/static/emotions/default/2.gif","/Scripts/plugs/wangEditor/static/emotions/default/3.gif","/Scripts/plugs/wangEditor/static/emotions/default/4.gif","/Scripts/plugs/wangEditor/static/emotions/default/5.gif","/Scripts/plugs/wangEditor/static/emotions/default/6.gif","/Scripts/plugs/wangEditor/static/emotions/default/7.gif","/Scripts/plugs/wangEditor/static/emotions/default/8.gif","/Scripts/plugs/wangEditor/static/emotions/default/9.gif","/Scripts/plugs/wangEditor/static/emotions/default/10.gif","/Scripts/plugs/wangEditor/static/emotions/default/11.gif","/Scripts/plugs/wangEditor/static/emotions/default/12.gif","/Scripts/plugs/wangEditor/static/emotions/default/13.gif","/Scripts/plugs/wangEditor/static/emotions/default/14.gif","/Scripts/plugs/wangEditor/static/emotions/default/15.gif","/Scripts/plugs/wangEditor/static/emotions/default/16.gif","/Scripts/plugs/wangEditor/static/emotions/default/17.gif","/Scripts/plugs/wangEditor/static/emotions/default/18.gif","/Scripts/plugs/wangEditor/static/emotions/default/19.gif","/Scripts/plugs/wangEditor/static/emotions/default/20.gif","/Scripts/plugs/wangEditor/static/emotions/default/21.gif","/Scripts/plugs/wangEditor/static/emotions/default/22.gif","/Scripts/plugs/wangEditor/static/emotions/default/23.gif","/Scripts/plugs/wangEditor/static/emotions/default/24.gif","/Scripts/plugs/wangEditor/static/emotions/default/25.gif","/Scripts/plugs/wangEditor/static/emotions/default/26.gif","/Scripts/plugs/wangEditor/static/emotions/default/27.gif","/Scripts/plugs/wangEditor/static/emotions/default/28.gif","/Scripts/plugs/wangEditor/static/emotions/default/29.gif","/Scripts/plugs/wangEditor/static/emotions/default/30.gif","/Scripts/plugs/wangEditor/static/emotions/default/31.gif","/Scripts/plugs/wangEditor/static/emotions/default/32.gif","/Scripts/plugs/wangEditor/static/emotions/default/33.gif","/Scripts/plugs/wangEditor/static/emotions/default/34.gif","/Scripts/plugs/wangEditor/static/emotions/default/35.gif","/Scripts/plugs/wangEditor/static/emotions/default/36.gif","/Scripts/plugs/wangEditor/static/emotions/default/37.gif","/Scripts/plugs/wangEditor/static/emotions/default/38.gif","/Scripts/plugs/wangEditor/static/emotions/default/39.gif","/Scripts/plugs/wangEditor/static/emotions/default/40.gif","/Scripts/plugs/wangEditor/static/emotions/default/41.gif","/Scripts/plugs/wangEditor/static/emotions/default/42.gif","/Scripts/plugs/wangEditor/static/emotions/default/43.gif","/Scripts/plugs/wangEditor/static/emotions/default/44.gif","/Scripts/plugs/wangEditor/static/emotions/default/45.gif","/Scripts/plugs/wangEditor/static/emotions/default/46.gif","/Scripts/plugs/wangEditor/static/emotions/default/47.gif","/Scripts/plugs/wangEditor/static/emotions/default/48.gif","/Scripts/plugs/wangEditor/static/emotions/default/49.gif","/Scripts/plugs/wangEditor/static/emotions/default/50.gif"]},jinxing:{title:"金星",size:50,imgs:["/Scripts/plugs/wangEditor/static/emotions/jinxing/1.gif","/Scripts/plugs/wangEditor/static/emotions/jinxing/2.gif","/Scripts/plugs/wangEditor/static/emotions/jinxing/3.gif","/Scripts/plugs/wangEditor/static/emotions/jinxing/4.gif","/Scripts/plugs/wangEditor/static/emotions/jinxing/5.gif","/Scripts/plugs/wangEditor/static/emotions/jinxing/6.gif"]}};n.config.mapAk="TVhjYjq1ICT2qqL5LdS8mwas";n.config.uploadImgUrl="";n.config.uploadTimeout=2e4;n.config.uploadImgFns={};n.config.customUpload=!1;n.config.pasteFilter=!0}),t(function(n){n.UI={};n.UI.menus={"default":{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"><\/i><\/a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-bold"><\/i><\/a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-underline"><\/i><\/a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-italic"><\/i><\/a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-pencil"><\/i><\/a>',selected:".selected"},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-brush"><\/i><\/a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-strikethrough"><\/i><\/a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-eraser"><\/i><\/a>',selected:".selected"},quote:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-quotes-left"><\/i><\/a>',selected:".selected"},source:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-code"><\/i><\/a>',selected:".selected"},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-font2"><\/i><\/a>',selected:".selected"},fontsize:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-text-height"><\/i><\/a>',selected:".selected"},head:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-header"><\/i><\/a>',selected:".selected"},orderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-numbered"><\/i><\/a>',selected:".selected"},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-bullet"><\/i><\/a>',selected:".selected"},alignleft:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-left"><\/i><\/a>',selected:".selected"},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-center"><\/i><\/a>',selected:".selected"},alignright:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-right"><\/i><\/a>',selected:".selected"},link:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-link"><\/i><\/a>',selected:".selected"},unlink:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-unlink"><\/i><\/a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-table"><\/i><\/a>',selected:".selected"},emotion:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-happy"><\/i><\/a>',selected:".selected"},img:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-picture"><\/i><\/a>',selected:".selected"},video:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-play"><\/i><\/a>',selected:".selected"},location:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-location"><\/i><\/a>',selected:".selected"},insertcode:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-terminal"><\/i><\/a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-ccw"><\/i><\/a>',selected:".selected"},redo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-cw"><\/i><\/a>',selected:".selected"},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-enlarge2"><\/i><\/a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-shrink2"><\/i><\/a>'}}}),t(function(n,t){n.fn.initDefaultConfig=function(){var i=this;i.config=t.extend({},n.config);i.UI=t.extend({},n.UI)}}),t(function(n,t){n.fn.addEditorContainer=function(){this.$editorContainer=t('<div class="wangEditor-container"><\/div>')}}),t(function(n){n.fn.addTxt=function(){var t=this,i=new n.Txt(t);t.txt=i}}),t(function(n){n.fn.addMenuContainer=function(){var t=this;t.menuContainer=new n.MenuContainer(t)}}),t(function(n,t){n.createMenuFns=[];n.createMenu=function(t){n.createMenuFns.push(t)};n.fn.addMenus=function(){function u(n){return r.indexOf(n)>=0?!0:!1}var i=this,r=i.config.menus;t.each(n.createMenuFns,function(n,t){t.call(i,u)})}}),t(function(n){n.createMenu(function(t){var r="bold";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.bold,commandName:"Bold"});u.clickEventSelected=function(n){var t=i.isRangeEmpty();t?i.commandForElem("b,strong,h1,h2,h3,h4,h5",n,"Bold"):i.command(n,"Bold")};i.menus[r]=u}})}),t(function(n){n.createMenu(function(t){var r="underline";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.underline,commandName:"Underline"});u.clickEventSelected=function(n){var t=i.isRangeEmpty();t?i.commandForElem("u,a",n,"Underline"):i.command(n,"Underline")};i.menus[r]=u}})}),t(function(n){n.createMenu(function(t){var r="italic";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.italic,commandName:"Italic"});u.clickEventSelected=function(n){var t=i.isRangeEmpty();t?i.commandForElem("i",n,"Italic"):i.command(n,"Italic")};i.menus[r]=u}})}),t(function(n,t){n.createMenu(function(i){var f="forecolor";if(i(f)){var r=this,o=r.config.lang,s=r.config.colors,u=new n.Menu({editor:r,id:f,title:o.forecolor}),e=t("<div><\/div>");t.each(s,function(n,t){e.append(['<a href="#" class="color-item"','    title="'+t+'" commandValue="'+n+'" ','    style="color: '+n+'" ','><i class="wangeditor-menu-img-pencil"><\/i><\/a>'].join(""))});e.on("click","a[commandValue]",function(n){var f=t(this),i=f.attr("commandValue");u.selected&&r.isRangeEmpty()?r.commandForElem("font[color]",n,"forecolor",i):r.command(n,"forecolor",i)});u.dropPanel=new n.DropPanel(r,u,{$content:e,width:125});u.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"font[color]"),n)?!0:!1};r.menus[f]=u}})}),t(function(n,t){n.createMenu(function(i){function o(n){var t;return n&&n.style&&n.style.cssText!=null&&(t=n.style.cssText,t&&t.indexOf("background-color:")>=0)?!0:!1}var e="bgcolor",u,f;if(i(e)){var r=this,s=r.config.lang,h=r.config.colors;u=new n.Menu({editor:r,id:e,title:s.bgcolor});f=t("<div><\/div>");t.each(h,function(n,t){f.append(['<a href="#" class="color-item"','    title="'+t+'" commandValue="'+n+'" ','    style="color: '+n+'" ','><i class="wangeditor-menu-img-brush"><\/i><\/a>'].join(""))});f.on("click","a[commandValue]",function(n){var f=t(this),i=f.attr("commandValue");u.selected&&r.isRangeEmpty()?r.commandForElem({selector:"span,font",check:o},n,"BackColor",i):r.command(n,"BackColor",i)});u.dropPanel=new n.DropPanel(r,u,{$content:f,width:125});u.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"span,font",o),n)?!0:!1};r.menus[e]=u}})}),t(function(n){n.createMenu(function(t){var r="strikethrough";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.strikethrough,commandName:"StrikeThrough"});u.clickEventSelected=function(n){var t=i.isRangeEmpty();t?i.commandForElem("strike",n,"StrikeThrough"):i.command(n,"StrikeThrough")};i.menus[r]=u}})}),t(function(n,t){n.createMenu(function(i){var u="eraser";if(i(u)){var r=this,e=r.config.lang,f=new n.Menu({editor:r,id:u,title:e.eraser,commandName:"RemoveFormat"});f.clickEvent=function(n){function f(){var n=this,r,u,f,e,o,s,h;r=n.getRangeElem();e=n.getSelfOrParentByName(r,"blockquote");e&&(o=t(e),i=t("<p>"+o.text()+"<\/p>"),o.after(i).remove());u=n.getSelfOrParentByName(r,"p,h1,h2,h3,h4,h5");u&&(f=t(u),i=t("<p>"+f.text()+"<\/p>"),f.after(i).remove());s=n.getSelfOrParentByName(r,"ul,ol");s&&(h=t(s),i=t("<p>"+h.text()+"<\/p>"),h.after(i).remove())}function e(){var n=this;i&&n.restoreSelectionByElem(i.get(0))}var u=r.isRangeEmpty(),i;if(!u){r.command(n,"RemoveFormat");return}r.customCommand(n,f,e)};r.menus[u]=f}})}),t(function(n,t){n.createMenu(function(i){function s(){var t=r.$codeTextarea,i=u.txt.$txt,n=t.val();u.config.jsFilter&&(n=n.replace(/<script[\s\S]*?<\/script>/ig,""));i.html(n)}var f="source";if(i(f)){var u=this,o=u.config.lang,e,r=new n.Menu({editor:u,id:f,title:o.source});r.isShowCode=!1;r.clickEvent=function(){var u=this,f=u.editor,n=f.txt.$txt,s=n.outerHeight(),o=n.height(),i;u.$codeTextarea||(u.$codeTextarea=t('<textarea class="code-textarea"><\/textarea>'));i=u.$codeTextarea;i.css({height:o,"margin-top":s-o});i.val(n.html());n.after(i).hide();i.show();r.isShowCode=!0;this.updateSelected();f.disableMenusExcept("source");e=n.html()};r.clickEventSelected=function(){var i=this,n=i.editor,t=n.txt.$txt,u=i.$codeTextarea;u&&(s(),u.after(t).hide(),t.show(),r.isShowCode=!1,this.updateSelected(),n.enableMenusExcept("source"),t.html()!==e&&n.onchange&&typeof n.onchange=="function"&&n.onchange.call(n))};r.updateSelectedEvent=function(){return this.isShowCode};u.menus[f]=r}})}),t(function(n,t){n.createMenu(function(i){var f="quote";if(i(f)){var r=this,e=r.config.lang,u=new n.Menu({editor:r,id:f,title:e.quote,commandName:"formatBlock",commandValue:"blockquote"});u.clickEvent=function(n){function o(){u=t("<p>"+f.text()+"<\/p>");f.after(u).remove();u.wrap("<blockquote>")}function s(){var n=this;u&&n.restoreSelectionByElem(u.get(0))}var i=r.getRangeElem(),f,e,u;if(!i){n.preventDefault();return}if(e=r.getSelfOrParentByName(i,"blockquote"),e){n.preventDefault();return}if(i=r.getLegalTags(i),f=t(i),f.text()){if(!i){r.command(n,"formatBlock","blockquote");return}r.customCommand(n,o,s)}};u.clickEventSelected=function(n){function e(){var n,r;if(n=t(i),r=n.children(),r.length){r.each(function(){var i=t(this);i.get(0).nodeName==="P"?n.after(i):n.after("<p>"+i.text()+"<\/p>");u=i});n.remove();return}}function o(){var n=this;u&&n.restoreSelectionByElem(u.get(0))}var f,i,u;if(f=r.getRangeElem(),i=r.getSelfOrParentByName(f,"blockquote"),!i){n.preventDefault();return}r.customCommand(n,e,o)};u.updateSelectedEvent=function(){var i=this,t=i.editor,n;return(n=t.getRangeElem(),n=t.getSelfOrParentByName(n,"blockquote"),n)?!0:!1};r.menus[f]=u;r.ready(function(){var n=this,r=n.txt.$txt,i=!1;r.on("keydown",function(r){var u,e,f;if(r.keyCode!==13){i=!1;return}if(u=n.getRangeElem(),u=n.getSelfOrParentByName(u,"blockquote"),!u){i=!1;return}if(!i){i=!0;return}e=n.getRangeElem();f=t(e);f.length&&f.parent().after(f);n.restoreSelectionByElem(e,"start");i=!1;r.preventDefault()})});r.ready(function(){function u(){i&&i.remove()}function f(){if(i){var t=i.prev();t.length?n.restoreSelectionByElem(t.get(0)):n.initSelection()}}var n=this,r=n.txt.$txt,i;r.on("keydown",function(r){var e,o;r.keyCode===8&&(e=n.getRangeElem(),e=n.getSelfOrParentByName(e,"blockquote"),e)&&((i=t(e),o=i.text(),o)||n.customCommand(r,u,f))})})}})}),t(function(n,t){n.createMenu(function(i){var f="fontfamily",o;if(i(f)){var r=this,s=r.config.lang,h=r.config.familys,u=new n.Menu({editor:r,id:f,title:s.fontfamily,commandName:"fontName"}),e={};t.each(h,function(n,t){e[t]=t});o='<span style="font-family:{#commandValue};">{#title}<\/span>';u.dropList=new n.DropList(r,u,{data:e,tpl:o,selectorForELemCommand:"font[face]"});u.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"font[face]"),n)?!0:!1};r.menus[f]=u}})}),t(function(n){n.createMenu(function(t){var u="fontsize";if(t(u)){var i=this,f=i.config.lang,e=i.config.fontsizes,r=new n.Menu({editor:i,id:u,title:f.fontsize,commandName:"fontSize"}),o=e;r.dropList=new n.DropList(i,r,{data:o,tpl:'<span style="font-size:{#title};">{#title}<\/span>',selectorForELemCommand:"font[size]"});r.updateSelectedEvent=function(){var n=i.getRangeElem();return(n=i.getSelfOrParentByName(n,"font[size]"),n)?!0:!1};i.menus[u]=r}})}),t(function(n){n.createMenu(function(t){var u="head";if(t(u)){var i=this,f=i.config.lang,r=new n.Menu({editor:i,id:u,title:f.head,commandName:"formatBlock"});r.dropList=new n.DropList(i,r,{data:{"<h1>":"标题1","<h2>":"标题2","<h3>":"标题3","<h4>":"标题4","<h5>":"标题5"},tpl:"{#commandValue}{#title}"});r.updateSelectedEvent=function(){var n=i.getRangeElem();return(n=i.getSelfOrParentByName(n,"h1,h2,h3,h4,h5"),n)?!0:!1};i.menus[u]=r}})}),t(function(n){n.createMenu(function(t){var i="unorderlist";if(t(i)){var r=this,u=r.config.lang,f=new n.Menu({editor:r,id:i,title:u.unorderlist,commandName:"InsertUnorderedList"});r.menus[i]=f}})}),t(function(n){n.createMenu(function(t){var i="orderlist";if(t(i)){var r=this,u=r.config.lang,f=new n.Menu({editor:r,id:i,title:u.orderlist,commandName:"InsertOrderedList"});r.menus[i]=f}})}),t(function(n){n.createMenu(function(t){var r="alignleft";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.alignleft,commandName:"JustifyLeft"});u.updateSelectedEvent=function(){var n=i.getRangeElem();return(n=i.getSelfOrParentByName(n,"p,h1,h2,h3,h4,h5,li",function(n){var t;return n&&n.style&&n.style.cssText!=null&&(t=n.style.cssText,t&&/text-align:\s*left;/.test(t))?!0:!1}),n)?!0:!1};i.menus[r]=u}})}),t(function(n){n.createMenu(function(t){var r="aligncenter";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.aligncenter,commandName:"JustifyCenter"});u.updateSelectedEvent=function(){var n=i.getRangeElem();return(n=i.getSelfOrParentByName(n,"p,h1,h2,h3,h4,h5,li",function(n){var t;return n&&n.style&&n.style.cssText!=null&&(t=n.style.cssText,t&&/text-align:\s*center;/.test(t))?!0:!1}),n)?!0:!1};i.menus[r]=u}})}),t(function(n){n.createMenu(function(t){var r="alignright";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.alignright,commandName:"JustifyRight"});u.updateSelectedEvent=function(){var n=i.getRangeElem();return(n=i.getSelfOrParentByName(n,"p,h1,h2,h3,h4,h5,li",function(n){var t;return n&&n.style&&n.style.cssText!=null&&(t=n.style.cssText,t&&/text-align:\s*right;/.test(t))?!0:!1}),n)?!0:!1};i.menus[r]=u}})}),t(function(n,t){n.createMenu(function(i){var h="link";if(i(h)){var r=this,e=r.config.lang,u=new n.Menu({editor:r,id:h,title:e.link}),c=t("<div><\/div>"),o=t('<div style="margin:20px 10px;" class="clearfix"><\/div>'),l=o.clone(),a=o.clone().css("margin","0 10px"),f=t('<input type="text" class="block" placeholder="'+e.text+'"/>'),s=t('<input type="text" class="block" placeholder="'+e.link+'"/>'),v=t('<button class="right">'+e.submit+"<\/button>"),y=t('<button class="right gray">'+e.cancel+"<\/button>");o.append(f);l.append(s);a.append(v).append(y);c.append(o).append(l).append(a);u.dropPanel=new n.DropPanel(r,u,{$content:c,width:300});u.clickEvent=function(){var o=this,u=o.dropPanel,i,n,t,e;if(u.isShowing){u.hide();return}f.val("");s.val("");i="";n=r.getRangeElem();n=r.getSelfOrParentByName(n,"a");n&&(i=n.href||"");t="";e=r.isRangeEmpty();e?n&&(t=n.textContent||n.innerHTML):t=r.getRangeText()||"";i&&s.val(i);t&&f.val(t);e?f.removeAttr("disabled"):f.attr("disabled",!0);u.show()};u.updateSelectedEvent=function(){var n=r.getRangeElem();return(n=r.getSelfOrParentByName(n,"a"),n)?!0:!1};y.click(function(n){n.preventDefault();u.dropPanel.hide()});v.click(function(i){i.preventDefault();var k=r.getRangeElem(),h=r.getSelfOrParentByName(k,"a"),d=r.isRangeEmpty(),c,l,y,p,w=r.txt.$txt,a,b,v="link"+n.random(),e=t.trim(s.val()),o=t.trim(f.val());if(!e){u.dropPanel.focusFirstInput();return}o||(o=e);d?h?(c=t(h),y=function(){c.attr("href",e);c.text(o)},p=function(){var n=this;n.restoreSelectionByElem(h)},r.customCommand(i,y,p)):(l='<a href="'+e+'" target="_blank">'+o+"<\/a>",n.userAgent.indexOf("Firefox")>0&&(l+="<span>&nbsp;<\/span>"),r.command(i,"insertHtml",l)):(a=w.find("a"),a.attr(v,"1"),r.command(i,"createLink",e),b=w.find("a").not("["+v+"]"),b.attr("target","_blank"),a.removeAttr(v))});r.menus[h]=u}})}),t(function(n,t){n.createMenu(function(i){var u="unlink";if(i(u)){var r=this,e=r.config.lang,f=new n.Menu({editor:r,id:u,title:e.unlink,commandName:"unLink"});f.clickEvent=function(n){function s(){u.after(f).remove()}function h(){r.restoreSelectionByElem(f.get(0))}var o=r.isRangeEmpty(),e,i,u,f;if(!o){r.command(n,"unLink");return}if(e=r.getRangeElem(),i=r.getSelfOrParentByName(e,"a"),!i){n.preventDefault();return}u=t(i);f=t("<span>"+u.text()+"<\/span>");r.customCommand(n,s,h)};r.menus[u]=f}})}),t(function(n,t){n.createMenu(function(i){var o="table";if(i(o)){for(var u=this,v=u.config.lang,s=new n.Menu({editor:u,id:o,title:v.table}),h=t('<div style="font-size: 14px; color: #666; text-align:right;"><\/div>'),r=t('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">'),l=t("<span>0<\/span>"),y=t("<span> 行 <\/span>"),a=t("<span>0<\/span>"),p=t("<span> 列<\/span>"),c,e,f=0;f<10;f++){for(c=t('<tr index="'+(f+1)+'">'),e=0;e<10;e++)c.append(t('<td index="'+(e+1)+'">'));r.append(c)}h.append(r);h.append(l).append(y).append(a).append(p);r.on("mouseenter","td",function(n){var i=t(n.currentTarget),u=i.attr("index"),e=i.parent(),f=e.attr("index");l.text(f);a.text(u);r.find("tr").each(function(){var n=t(this),i=n.attr("index");parseInt(i,10)<=parseInt(f,10)?n.find("td").each(function(){var n=t(this),i=n.attr("index");parseInt(i,10)<=parseInt(u,10)?n.addClass("active"):n.removeClass("active")}):n.find("td").removeClass("active")})}).on("mouseleave",function(){r.find("td").removeClass("active")});r.on("click","td",function(n){for(var e=t(n.currentTarget),o=e.attr("index"),s=e.parent(),h=s.attr("index"),c=parseInt(h,10),l=parseInt(o,10),f,i="\n<table>",r=0;r<c;r++){for(i+="\n  <tr>",f=0;f<l;f++)i+="\n    <td><span>&nbsp;<\/span><\/td>";i+="\n  <\/tr>"}i+="\n<\/table>\n";u.command(n,"insertHtml",i)});s.dropPanel=new n.DropPanel(u,s,{$content:h,width:181});u.menus[o]=s}})}),t(function(n,t){n.createMenu(function(i){var o="emotion";if(i(o)){var r=this,h=r.config.lang,c=r.config.emotions,f=new n.Menu({editor:r,id:o,title:h.emotion}),s=t('<div class="panel-tab"><\/div>'),e=t('<div class="tab-container"><\/div>'),u=t('<div class="content-container"><\/div>');t.each(c,function(n,i){var s=i.title,o=i.size,h=i.imgs,f=t('<a href="#">'+s+" <\/a>"),r;e.append(f);r=t('<div class="content"><\/div>');u.append(r);t.each(h,function(n,i){var f=t('<a href="#" commandValue="'+i+'"><\/a>'),u=t("<img>");u.css({width:o+"px",height:o+"px"});u.attr("_src",i);f.append(u);r.append(f)});f.click(function(n){e.children().removeClass("selected");u.children().removeClass("selected");r.addClass("selected");f.addClass("selected");n.preventDefault()})});s.append(e).append(u);e.children().first().addClass("selected");u.children().first().addClass("selected");u.on("click","a[commandValue]",function(n){var i=t(n.currentTarget),u=i.attr("commandValue");r.command(n,"InsertImage",u)});f.dropPanel=new n.DropPanel(r,f,{$content:s,width:350});f.clickEvent=function(){var i=this,r=i.dropPanel;if(r.isShowing){r.hide();return}(r.show(),i.imgLoaded)||(u.find("img").each(function(){var i=t(this),r=i.attr("_src");i.on("error",function(){n.error("加载不出表情图片 "+r)});i.attr("src",r);i.removeAttr("_src")}),i.imgLoaded=!0)};r.menus[o]=f}})}),t(function(n,t){function i(n,i,r){function h(){u.val("")}var o=n.config.lang,s=t('<div style="margin:20px 10px 10px 10px;"><\/div>'),u=t('<input type="text" class="block" placeholder="http://"/>'),f,e;s.append(u);f=t('<button class="right">'+o.submit+"<\/button>");e=t('<button class="right gray">'+o.cancel+"<\/button>");r.append(s).append(f).append(e);e.click(function(n){n.preventDefault();i.dropPanel.hide()});f.click(function(i){var r,f;if(i.preventDefault(),r=t.trim(u.val()),!r){u.focus();return}f='<img style="max-width:100%;" src="'+r+'"/>';n.command(i,"insertHtml",f,h)})}n.createMenu(function(r){function p(){c.click(function(n){s.children().removeClass("selected");h.children().removeClass("selected");f.addClass("selected");c.addClass("selected");n.preventDefault()});l.click(function(t){s.children().removeClass("selected");h.children().removeClass("selected");e.addClass("selected");l.addClass("selected");t.preventDefault();n.placeholder&&e.find("input[type=text]").focus()});c.click()}function w(){s.remove();f.remove();e.addClass("selected")}var a="img",c,l,f,e;if(r(a)){var u=this,y=u.config.lang,o=new n.Menu({editor:u,id:a,title:y.img}),v=t('<div class="panel-tab"><\/div>'),s=t('<div class="tab-container"><\/div>'),h=t('<div class="content-container"><\/div>');v.append(s).append(h);c=t('<a href="#">上传图片<\/a>');l=t('<a href="#">网络图片<\/a>');s.append(c).append(l);f=t('<div class="content"><\/div>');h.append(f);e=t('<div class="content"><\/div>');h.append(e);i(u,o,e);o.dropPanel=new n.DropPanel(u,o,{$content:v,width:400,onRender:function(){var n=u.config.customUploadInit;n&&n.call(u)}});u.menus[a]=o;u.ready(function(){function u(){o.dropPanel.hide()}var n=this,t=n.config,i=t.uploadImgUrl,r=t.customUpload;i||r?(n.$uploadContent=f,p()):w();f.click(function(){setTimeout(u)})})}})}),t(function(n,t){n.createMenu(function(i){var o="video";if(i(o)){var u=this,f=u.config.lang,w=/^\s*(http:\/\/|https:\/\/).+(\.swf|\.ogg|\.mp4|\.webm)/i,r=new n.Menu({editor:u,id:o,title:f.video,commandName:"unLink"}),b='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"         codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0"         width="#{width}"         height="#{height}" >   <param name="movie"           value="#{videoUrl}" />   <param name="allowFullScreen" value="true" />   <param name="allowScriptAccess" value="always" />   <param value="transparent" name="wmode" />   <embed src="#{videoUrl}"          width="#{width}"           height="#{height}"           name="cc_8E6888CDEA7087C49C33DC5901307461"           allowFullScreen="true"           wmode="transparent"           allowScriptAccess="always"           pluginspage="http://www.macromedia.com/go/getflashplayer"           type="application/x-shockwave-flash"/><\/object><p><br><\/p>',k='<video src="#{videoUrl}" controls="controls" width="#{width}" height="#{height}"><\/video><p><br><\/p>',s=t("<div><\/div>"),h=t('<div style="margin:20px 10px;"><\/div>'),e=t('<input type="text" class="block" placeholder="*.swf, *.mp4, *.ogg, *.webm"/>');h.append(e);var c=t('<div style="margin:20px 10px;"><\/div>'),l=t('<input type="text" value="480" style="width:50px;text-align:center;"/>'),a=t('<input type="text" value="360" style="width:50px;text-align:center;"/>');c.append("<span> "+f.width+" <\/span>").append(l).append("<span> px &nbsp;&nbsp;&nbsp;<\/span>").append("<span> "+f.height+" <\/span>").append(a).append("<span> px <\/span>");var v=t("<div><\/div>"),y=t('<button class="right">'+f.submit+"<\/button>"),p=t('<button class="right gray">'+f.cancel+"<\/button>");v.append(y).append(p);s.append(h).append(c).append(v);p.click(function(n){n.preventDefault();e.val("");r.dropPanel.hide()});y.click(function(n){n.preventDefault();var i=t.trim(e.val()),f=parseInt(l.val()),o=parseInt(a.val()),s;if(!i){r.dropPanel.focusFirstInput();return}if(!w.test(i)){alert("视频链接格式错误！");r.dropPanel.focusFirstInput();return}if(isNaN(f)||isNaN(o)){alert("宽度或高度不是数字！");return}s=/.swf/i.test(i)?b.replace(/#{videoUrl}/ig,i).replace(/#{width}/ig,f).replace(/#{height}/ig,o):k.replace(/#{videoUrl}/ig,i).replace(/#{width}/ig,f).replace(/#{height}/ig,o);u.command(n,"insertHtml",s);e.val("")});r.dropPanel=new n.DropPanel(u,r,{$content:s,width:400});u.menus[o]=r}})}),t(function(n,t){var r=function(n){return"onkeyup"in n}(document.createElement("input")),i;n.baiduMapAk="TVhjYjq1ICT2qqL5LdS8mwas";i=1;n.createMenu(function(u){function b(){e.val("")}var v="location",f,y,h,e,p,a,w;if(u(v)){if(i++>1){n.error("目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单");return}var o=this,k=o.config,s=k.lang,d=k.mapAk;o.mapData={};f=o.mapData;f.markers=[];f.mapContainerId="map"+n.random();f.clearLocations=function(){var n=f.map;n&&(n.clearOverlays(),f.markers=[])};f.searchMap=function(){var n=f.map;if(n){var u=window.BMap,i=c.val(),t=e.val(),o,r;i!==""&&(t&&t!==""||n.centerAndZoom(i,11),t&&t!==""&&(o=new u.Geocoder,o.getPoint(t,function(t){t?(n.centerAndZoom(t,13),r=new u.Marker(t),n.addOverlay(r),r.enableDragging(),f.markers.push(r)):n.centerAndZoom(i,11)},i)))}};y=!1;window.baiduMapCallBack=function(){function o(i){var s=i.name,u,o;if(t.setCenter(s),c.val(s),n.placeholder&&e.focus(),r){o=function(n){n.type==="keyup"&&n.keyCode===13&&n.preventDefault();u&&clearTimeout(u);u=setTimeout(f.searchMap,500)};c.on("keyup change paste",o);e.on("keyup change paste",o)}else o=function(){if(!l.is(":visible")){clearTimeout(u);return}var n="",t="",i=c.val(),r=e.val();(i!==n||r!==t)&&(f.searchMap(),n=i,t=r);u&&clearTimeout(u);u=setTimeout(o,1e3)},u=setTimeout(o,1e3)}var i,t,u;y||(y=!0,i=window.BMap,f.map||(f.map=new i.Map(f.mapContainerId)),t=f.map,t.centerAndZoom(new i.Point(116.404,39.915),11),t.addControl(new i.MapTypeControl),t.setCurrentCity("北京"),t.enableScrollWheelZoom(!0),u=new i.LocalCity,u.get(o),t.addEventListener("click",function(n){var r=new i.Marker(new i.Point(n.point.lng,n.point.lat));t.addOverlay(r);r.enableDragging();f.markers.push(r)},!1))};f.loadMapScript=function(){var t=document.createElement("script");t.type="text/javascript";t.src="http://api.map.baidu.com/api?v=2.0&ak="+d+"&callback=baiduMapCallBack";try{document.body.appendChild(t)}catch(i){n.error("加载地图过程中发生错误")}};f.initMap=function(){window.BMap?window.baiduMapCallBack():f.loadMapScript()};h=new n.Menu({editor:o,id:v,title:s.location});o.menus[v]=h;var l=t("<div><\/div>"),g=t('<div style="margin:10px 0;"><\/div>'),c=t('<input type="text"/>');c.css({width:"80px","text-align":"center"});e=t('<input type="text"/>');e.css({width:"300px","margin-left":"10px"}).attr("placeholder",s.searchlocation);p=t('<button class="right link">'+s.clearLocation+"<\/button>");g.append(p).append(c).append(e);l.append(g);p.click(function(n){e.val("");e.focus();f.clearLocations();n.preventDefault()});a=t('<div id="'+f.mapContainerId+'"><\/div>');a.css({height:"260px",width:"100%",position:"relative","margin-top":"10px",border:"1px solid #f1f1f1"});w=t("<span>"+s.loading+"<\/span>");w.css({position:"absolute",width:"100px","text-align":"center",top:"45%",left:"50%","margin-left":"-50px"});a.append(w);l.append(a);var nt=t('<div style="margin:10px 0;"><\/div>'),tt=t('<button class="right">'+s.submit+"<\/button>"),it=t('<button class="right gray">'+s.cancel+"<\/button>"),rt=t('<label style="display:inline-block;margin-top:10px;color:#666;"><\/label>'),ut=t('<input type="checkbox">');rt.append(ut).append('<span style="display:inline-block;margin-left:5px;">  '+s.dynamicMap+"<\/span>");nt.append(rt).append(tt).append(it);l.append(nt);it.click(function(n){n.preventDefault();b();h.dropPanel.hide()});tt.click(function(n){n.preventDefault();var u=f.map,c=ut.is(":checked"),e=f.markers,l=u.getCenter(),p=l.lng,w=l.lat,k=u.getZoom(),a=u.getSize(),v=a.width,y=a.height,h,i,r;if(i=c?"http://ueditor.baidu.com/ueditor/dialogs/map/show.html#":"http://api.map.baidu.com/staticimage?",i=i+"center="+p+","+w+"&zoom="+k+"&width="+v+"&height="+y,e.length>0&&(i=i+"&markers=",t.each(e,function(n,t){h=t.getPosition();n>0&&(i=i+"|");i=i+h.lng+","+h.lat})),c){if(e.length>1){alert(s.langDynamicOneLocation);return}i+="&markerStyles=l,A";r='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+v+'" height="'+y+'"><\/iframe>';r=r.replace("{src}",i);o.command(n,"insertHtml",r,b)}else o.command(n,"insertHtml",'<img style="max-width:100%;" src="'+i+'"/>',b)});h.dropPanel=new n.DropPanel(o,h,{$content:l,width:500});h.onRender=function(){d===n.baiduMapAk&&n.warn("建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档："+n.docsite)};h.clickEvent=function(){var i=this,n=i.dropPanel,t=!1;if(n.isShowing){n.hide();return}f.map||(t=!0);f.initMap();n.show();t||e.focus()}}})}),t(function(n,t){function i(){if(!(n.userAgent.indexOf("MSIE 8")>0)){var t=document.createElement("script");t.type="text/javascript";t.src="http://apps.bdimg.com/libs/highlight.js/9.1.0/highlight.min.js";document.body.appendChild(t)}}n.createMenu(function(r){function a(n){var r=t("<div><\/div>"),i;r.css({margin:"15px 5px 5px 5px",height:"160px","text-align":"center"});o.css({width:"100%",height:"100%",padding:"10px"});o.on("keydown",function(n){n.keyCode===9&&n.preventDefault()});r.append(o);n.append(r);var s=t("<div><\/div>"),c=t('<button class="right">'+h.submit+"<\/button>"),l=t('<button class="right gray">'+h.cancel+"<\/button>");s.append(c).append(l).append(e);n.append(s);l.click(function(n){n.preventDefault();f.dropPanel.hide()});i='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}<\/code><\/pre>';c.click(function(n){function p(){var n;h&&(n=l.attr("class"),n!==h+" hljs"&&l.attr("class",h+" hljs"));l.html(r)}function w(){u.restoreSelectionByElem(s);v()}var r,c,y,s,l;if(n.preventDefault(),r=o.val(),!r){o.focus();return}c=u.getRangeElem();t.trim(t(c).text())&&(i="<p><br><\/p>"+i);var h=e?e.val():"",a="",v=function(){t("pre code").each(function(n,t){window.hljs&&window.hljs.highlightBlock(t)})};if(h&&(a=' class="'+h+' hljs"'),r=r.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;"),!f.selected){y=i.replace("{#langClass}",a).replace("{#content}",r);u.command(n,"insertHtml",y,v);return}(s=u.getSelfOrParentByName(c,"pre"),s&&(s=u.getSelfOrParentByName(c,"code")),s)&&(l=t(s),u.customCommand(n,p,w))})}function v(){var n=u.getRangeElem(),t=u.getSelfOrParentByName(n,"code");t?u.disableMenusExcept("insertcode"):u.enableMenusExcept("insertcode")}var s="insertcode";if(r(s)){setTimeout(i,0);var u=this,h=u.config.lang,c=u.txt.$txt,f=new n.Menu({editor:u,id:s,title:h.insertcode});f.clickEvent=function(){var r=this,i=r.dropPanel,n;if(i.isShowing){i.hide();return}o.val("");i.show();n=window.hljs;n&&n.listLanguages?(e.css({"margin-top":"9px","margin-left":"5px"}),t.each(n.listLanguages(),function(n,t){e.append('<option value="'+t+'">'+t+"<\/option>")})):e.hide()};f.clickEventSelected=function(){var h=this,i=h.dropPanel,r,n,f,s;if(i.isShowing){i.hide();return}(i.show(),r=u.getRangeElem(),n=u.getSelfOrParentByName(r,"pre"),n&&(n=u.getSelfOrParentByName(r,"code")),n)&&(f=t(n),o.val(f.text()),e&&(s=f.attr("class"),s&&e.val(s.split(" ")[0])))};f.updateSelectedEvent=function(){var i=this,t=i.editor,n;return(n=t.getRangeElem(),n=t.getSelfOrParentByName(n,"pre"),n)?!0:!1};var l=t("<div><\/div>"),o=t("<textarea><\/textarea>"),e=t("<select><\/select>");a(l);f.dropPanel=new n.DropPanel(u,f,{$content:l,width:500});u.menus[s]=f;c.on("keydown",function(n){if(n.keyCode===13){var t=u.getRangeElem(),i=u.getSelfOrParentByName(t,"code");i&&u.command(n,"insertHtml","\n")}});c.on("keydown click",function(){setTimeout(v)})}})}),t(function(n){n.createMenu(function(t){var r="undo";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.undo});u.clickEvent=function(){i.undo()};i.menus[r]=u;i.ready(function(){function i(){n.undoRecord()}var n=this,r=n.txt.$txt,t;r.on("keyup",function(r){var u=r.keyCode;if(r.ctrlKey&&u===90){n.undo();return}u===13?i():(t&&clearTimeout(t),t=setTimeout(i,1e3))});n.undoRecord()})}})}),t(function(n){n.createMenu(function(t){var r="redo";if(t(r)){var i=this,f=i.config.lang,u=new n.Menu({editor:i,id:r,title:f.redo});u.clickEvent=function(){i.redo()};i.menus[r]=u}})}),t(function(n){var t;n.createMenu(function(i){var e="fullscreen";if(i(e)){var r=this,u=r.txt.$txt,s=r.config,l=s.zindex||1e4,a=s.lang,o=!1,h,c,f=new n.Menu({editor:r,id:e,title:a.fullscreen});f.clickEvent=function(){var i=r.$editorContainer,f,e,s,a;i.addClass("wangEditor-fullscreen");h=i.css("z-index");i.css("z-index",l);e=u.height();s=u.outerHeight();r.useMaxHeight&&(c=u.css("max-height"),u.css("max-height","none"),f=u.parent(),f.after(u),f.remove(),u.css("overflow-y","auto"));a=r.menuContainer;u.height(n.$window.height()-a.height()-(s-e));r.menuContainer.$menuContainer.attr("style","");o=!0;r.isFullScreen=!0;t=n.$window.scrollTop()};f.clickEventSelected=function(){var i=r.$editorContainer;i.removeClass("wangEditor-fullscreen");i.css("z-index",h);r.useMaxHeight?u.css("max-height",c):r.$valueContainer.css("height",r.valueContainerHeight);r.txt.initHeight();o=!1;r.isFullScreen=!1;t!=null&&n.$window.scrollTop(t)};f.updateSelectedEvent=function(){return o};r.menus[e]=f}})}),t(function(n,t){n.fn.renderMenus=function(){var n=this,u=n.menus,f=n.config.menus,e=n.menuContainer,i,r=0;t.each(f,function(n,t){if(t==="|"){r++;return}i=u[t];i&&i.render(r)})}}),t(function(n){n.fn.renderMenuContainer=function(){var n=this,t=n.menuContainer,i=n.$editorContainer;t.render()}}),t(function(n){n.fn.renderTxt=function(){var n=this,t=n.txt;t.render();n.ready(function(){t.initHeight()})}}),t(function(n){n.fn.renderEditorContainer=function(){var n=this,i=n.$valueContainer,r=n.$editorContainer,f=n.txt.$txt,t,u;i===f?(t=n.$prev,u=n.$parent,t&&t.length?t.after(r):u.prepend(r)):(i.after(r),i.hide())}}),t(function(n,t){n.fn.eventMenus=function(){var n=this.menus;t.each(n,function(n,t){t.bindEvent()})}}),t(function(n){n.fn.eventMenuContainer=function(){}}),t(function(n){n.fn.eventTxt=function(){var n=this.txt;n.saveSelectionEvent();n.updateValueEvent();n.updateMenuStyleEvent()}}),t(function(n){n.plugin(function(){var i=this,t=i.config.uploadImgFns;t.onload||(t.onload=function(t){n.log("上传结束，返回结果为 "+t);var r=this,i;t.indexOf("error|")===0?(n.warn("上传失败："+t.split("|")[1]),alert(t.split("|")[1])):(n.log("上传成功，即将插入编辑区域，结果为："+t),i=document.createElement("img"),i.onload=function(){var u='<img src="'+t+'" style="max-width:100%;"/>';r.command(null,"insertHtml",u);n.log("已插入图片，地址 "+t);i=null},i.onerror=function(){n.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+t);i=null},i.src=t)});t.ontimeout||(t.ontimeout=function(){n.error("上传上图片发生错误");alert("上传上图片发生错误")});t.onerror||(t.onerror=function(){n.error("上传图片超时");alert("上传图片超时")})})}),t(function(n){window.FileReader&&window.FormData&&n.plugin(function(){function h(n,t){for(var r=window.atob(n.split(",")[1]),u=new ArrayBuffer(r.length),f=new Uint8Array(u),i=0;i<r.length;i++)f[i]=r.charCodeAt(i);return new Blob([u],{type:t})}function c(i,r){var u=document.createElement("img");u.onload=function(){var f='<img src="'+i+'" style="max-width:100%;"/>';t.command(r,"insertHtml",f);n.log("已插入图片，地址 "+i);u=null};u.onerror=function(){n.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+i);u=null};u.src=i}function l(n){if(n.lengthComputable){var i=n.loaded/n.total;t.showUploadProgress(i*100)}}var t=this,i=t.config,u=i.uploadImgUrl,f=i.uploadTimeout,r=i.uploadImgFns,e=r.onload,o=r.ontimeout,s=r.onerror;u&&(t.xhrUploadImg=function(i){function tt(){a&&clearTimeout(a);r&&r.abort&&r.abort();y.preventDefault();d&&d.call(t,r);t.hideUploadProgress()}var y=i.event,w=i.base64,v=i.fileType||"image/png",nt=i.name||"wangEditor_upload_file",b=i.loadfn||e,k=i.errorfn||s,d=i.timeoutfn||o,g="png",r,a,p;if(v.indexOf("/")>0&&v.split("/")[1]&&(g=v.split("/")[1]),n.isOnWebsite){n.log("预览模拟上传");c(w,y);return}r=new XMLHttpRequest;p=new FormData;r.onload=function(){a&&clearTimeout(a);b&&b.call(t,r.responseText,r);t.hideUploadProgress()};r.onerror=function(){a&&clearTimeout(a);y.preventDefault();k&&k.call(t,r);t.hideUploadProgress()};r.upload.onprogress=l;p.append(nt,h(w,v),n.random()+"."+g);r.open("POST",u,!0);r.send(p);a=setTimeout(tt,f);n.log("开始上传...并开始超时计算")})})}),t(function(n,t){n.plugin(function(){function h(){f||(f=!0,i.css({top:o+"px"}),u.append(i))}function c(){i.hide();n=null}var r=this,e=r.menuContainer,o=e.height(),u=r.$editorContainer,s=u.width(),i=t('<div class="wangEditor-upload-progress"><\/div>'),f=!1,n;r.showUploadProgress=function(t){n&&clearTimeout(n);h();i.show();i.width(t*s/100)};r.hideUploadProgress=function(t){n&&clearTimeout(n);t=t||750;n=setTimeout(c,t)}})}),t(function(n,t){n.plugin(function(){var i=this,f=i.config,e=f.uploadImgUrl,s=f.uploadTimeout,h,r,u,o;e&&(r=i.$uploadContent,r)&&(u=t('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"><\/i><\/div>'),r.append(u),o=new n.UploadFile({editor:i,uploadUrl:e,timeout:s,fileAccept:"image/*"}),u.click(function(n){h=n;o.selectFiles()}))})}),t(function(n,t){if(window.FileReader&&window.FormData){var i=function(n){this.editor=n.editor;this.uploadUrl=n.uploadUrl;this.timeout=n.timeout;this.fileAccept=n.fileAccept;this.multiple=!0};i.fn=i.prototype;i.fn.clear=function(){this.$input.val("");n.log("input value 已清空")};i.fn.render=function(){var i=this;if(!i._hasRender){n.log("渲染dom");var u=i.fileAccept,e=u?'accept="'+u+'"':"",o=i.multiple,s=o?'multiple="multiple"':"",r=t('<input type="file" '+e+" "+s+"/>"),f=t('<div style="visibility:hidden;"><\/div>');f.append(r);n.$body.append(f);r.on("change",function(n){i.selected(n,r.get(0))});i.$input=r;i._hasRender=!0}};i.fn.selectFiles=function(){var t=this;n.log("使用 html5 方式上传");t.render();n.log("选择文件");t.$input.click()};i.fn.selected=function(i,r){var f=this,u=r.files||[];u.length!==0&&(n.log("选中 "+u.length+" 个文件"),t.each(u,function(n,t){f.upload(t)}))};i.fn.upload=function(t){function r(){u.clear()}var u=this,f=u.editor,e=t.name||"",l=t.type||"",i=f.config.uploadImgFns,o=i.onload,s=i.ontimeout,h=i.onerror,c=new FileReader;if(!o||!s||!h){n.error("请为编辑器配置上传图片的 onload ontimeout onerror 回调事件");return}n.log("开始执行 "+e+" 文件的上传");c.onload=function(t){n.log("已读取"+e+"文件");var i=t.target.result||this.result;f.xhrUploadImg({event:t,base64:i,fileType:l,name:"wangEditorH5File",loadfn:function(n,t){r();var i=this;o.call(i,n,t)},errorfn:function(t){r();n.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生");var i=this;h.call(i,t)},timeoutfn:function(t){r();n.isOnWebsite&&alert("wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生");var i=this;s(i,t)}})};c.readAsDataURL(t)};n.UploadFile=i}}),t(function(n,t){if(!window.FileReader||!window.FormData){var i=function(n){this.editor=n.editor;this.uploadUrl=n.uploadUrl;this.timeout=n.timeout;this.fileAccept=n.fileAccept;this.multiple=!1};i.fn=i.prototype;i.fn.clear=function(){this.$input.val("");n.log("input value 已清空")};i.fn.hideModal=function(){this.modal.hide()};i.fn.render=function(){var i=this,c=i.editor,f,h;if(!i._hasRender){f=i.uploadUrl;n.log("渲染dom");var r="iframe"+n.random(),e=t('<iframe name="'+r+'" id="'+r+'" frameborder="0" width="0" height="0"><\/iframe>'),l=i.multiple,a=l?'multiple="multiple"':"",v=t("<p>选择图片并上传<\/p>"),o=t('<input type="file" '+a+' name="wangEditorFormFile"/>'),y=t('<input type="submit" value="上传"/>'),s=t('<form enctype="multipart/form-data" method="post" action="'+f+'" target="'+r+'"><\/form>'),u=t('<div style="margin:10px 20px;"><\/div>');s.append(v).append(o).append(y);u.append(s);u.append(e);i.$input=o;i.$iframe=e;h=new n.Modal(c,undefined,{$content:u});i.modal=h;i._hasRender=!0}};i.fn.bindLoadEvent=function(){function r(){var i=t.trim(e.document.body.innerHTML);i&&(o(i),n.clear(),n.hideModal())}var n=this;if(!n._hasBindLoad){var u=n.editor,f=n.$iframe,i=f.get(0),e=i.contentWindow,o=u.config.uploadImgFns.onload;i.attachEvent?i.attachEvent("onload",r):i.onload=r;n._hasBindLoad=!0}};i.fn.show=function(){function i(){t.show();n.bindLoadEvent()}var n=this,t=n.modal;setTimeout(i)};i.fn.selectFiles=function(){var t=this;n.log("使用 form 方式上传");t.render();t.clear();t.show()};n.UploadFile=i}}),t(function(n,t){n.plugin(function(){function h(){var e=/^data:(image\/\w+);base64/,o=u.find("img");n.log("粘贴后，检查到编辑器有"+o.length+"个图片。开始遍历图片，试图找到刚刚粘贴过来的图片");t.each(o,function(){var o=this,s=t(o),h,u=s.attr("src"),c;(f.each(function(){if(o===this)return h=!0,!1}),h)||(n.log("找到一个粘贴过来的图片"),e.test(u)?(n.log("src 是 base64 格式，可以上传"),c=u.match(e)[1],r.xhrUploadImg({event:i,base64:u,fileType:c,name:"wangEditorPasteFile"})):n.log("src 为 "+u+" ，不是 base64 格式，暂时不支持上传"),s.remove())});n.log("遍历结束")}var r=this,e=r.txt,u=e.$txt,o=r.config,s=o.uploadImgUrl,i,f;if(s)u.on("paste",function(e){i=e;var o=i.clipboardData||i.originalEvent.clipboardData,c,s;(c=o==null?window.clipboardData&&window.clipboardData.getData("text"):o.getData("text/plain")||o.getData("text/html"),c)||(s=o&&o.items,s?(n.log("通过 data.items 得到了数据"),t.each(s,function(t,u){var e=u.type||"",o,f;e.indexOf("image")<0||(o=u.getAsFile(),f=new FileReader,n.log("得到一个粘贴图片"),f.onload=function(t){n.log("读取到粘贴的图片");var u=t.target.result||this.result;r.xhrUploadImg({event:i,base64:u,fileType:e,name:"wangEditorPasteFile"})},f.readAsDataURL(o))})):(n.log("未从 data.items 得到数据，使用检测粘贴图片的方式"),f=u.find("img"),n.log("粘贴前，检查到编辑器有"+f.length+"个图片"),setTimeout(h,0)))})})}),t(function(n,t){n.plugin(function(){var i=this,r=i.txt,u=r.$txt,f=i.config,e=f.uploadImgUrl;if(e){n.$document.on("dragleave drop dragenter dragover",function(n){n.preventDefault()});u.on("drop",function(r){r.preventDefault();var f=r.originalEvent,u=f.dataTransfer&&f.dataTransfer.files;u&&u.length&&t.each(u,function(t,u){var e=u.type,o=u.name,f;e.indexOf("image/")<0||(n.log("得到图片 "+o),f=new FileReader,f.onload=function(t){n.log("读取到图片 "+o);var u=t.target.result||this.result;i.xhrUploadImg({event:r,base64:u,fileType:e,name:"wangEditorDragFile"})},f.readAsDataURL(u))})})}})}),t(function(n,t){n.plugin(function(){function p(){c||(w(),r.append(o).append(l).append(a).append(v),u.$editorContainer.append(r),c=!0)}function w(){function t(t,i){n&&u.customCommand(t,n,i)}var n;l.click(function(r){n=function(){i.remove()};t(r,function(){setTimeout(f,100)})});v.click(function(r){n=function(){i.css({width:"100%"})};t(r,function(){setTimeout(s)})});a.click(function(r){n=function(){i.css({width:"auto"})};t(r,function(){setTimeout(s)})})}function s(){var c;if(!u._disabled&&i!=null){i.addClass("clicked");var f=i.position(),l=f.top,a=f.left,v=i.outerHeight(),y=i.outerWidth(),n=l+v,p=a,t=0,s=e.position().top,h=e.outerHeight();n>s+h&&(n=s+h);r.show();c=r.outerWidth();t=y/2-c/2;r.css({top:n+5,left:p,"margin-left":t});t<0?(r.css("margin-left","0"),o.hide()):o.show()}}function f(){i!=null&&(i.removeClass("clicked"),i=null,r.hide())}var u=this,y=u.txt,h=y.$txt,e=u.useMaxHeight?h.parent():h,i,c=!1,r=t('<div class="txt-toolbar"><\/div>'),o=t('<div class="tip-triangle"><\/div>'),l=t('<a href="#"><i class="wangeditor-menu-img-trash-o"><\/i><\/a>'),a=t('<a href="#"><i class="wangeditor-menu-img-search-minus"><\/i><\/a>'),v=t('<a href="#"><i class="wangeditor-menu-img-search-plus"><\/i><\/a>');e.on("click","table",function(n){var r=t(n.currentTarget);if(p(),i&&i.get(0)===r.get(0)){setTimeout(f,100);return}i=r;s();n.preventDefault();n.stopPropagation()}).on("click keypress scroll",function(){setTimeout(f,100)});n.$body.on("click keypress scroll",function(){setTimeout(f,100)})})}),t(function(n,t){n.userAgent.indexOf("MSIE 8")>0||n.plugin(function(){function g(){a||(nt(),tt(),f.append(s).append(v).append(y).append(p).append(w).append(b).append(k),r.$editorContainer.append(f).append(u),a=!0)}function nt(){function t(t,i){n&&r.customCommand(t,n,i)}var n;v.click(function(r){n=function(){i.remove()};t(r,function(){setTimeout(e,100)})});p.click(function(r){n=function(){var r=i.get(0),n=r.width,t=r.height;n=n*1.1;t=t*1.1;i.css({width:n+"px",height:t+"px"})};t(r,function(){setTimeout(c)})});y.click(function(r){n=function(){var r=i.get(0),n=r.width,t=r.height;n=n*.9;t=t*.9;i.css({width:n+"px",height:t+"px"})};t(r,function(){setTimeout(c)})});w.click(function(r){n=function(){i.parent().css({"text-align":"left"}).attr("align","left")};t(r,function(){setTimeout(e,100)})});k.click(function(r){n=function(){i.parent().css({"text-align":"right"}).attr("align","right")};t(r,function(){setTimeout(e,100)})});b.click(function(r){n=function(){i.parent().css({"text-align":"center"}).attr("align","center")};t(r,function(){setTimeout(e,100)})})}function tt(){function a(n){var f,e,h,a,v,y;f=n.pageX-o;e=n.pageY-s;h=t+f;a=r+e;u.css({"margin-left":h,"margin-top":a});v=c+f;y=l+e;i&&i.css({width:v,height:y})}var o,s,t,r,c,l;u.on("mousedown",function(v){if(i){o=v.pageX;s=v.pageY;t=parseFloat(u.css("margin-left"),10);r=parseFloat(u.css("margin-top"),10);c=i.width();l=i.height();f.hide();n.$document.on("mousemove._dragResizeImg",a);n.$document.on("mouseup._dragResizeImg",function(){n.$document.off("mousemove._dragResizeImg");n.$document.off("mouseup._dragResizeImg");e();u.css({"margin-left":t,"margin-top":r});h=!1});h=!0}})}function c(){var p;if(!r._disabled&&i!=null){i.addClass("clicked");var e=i.position(),h=e.top,c=e.left,l=i.outerHeight(),a=i.outerWidth();u.css({top:h+l,left:c+a});var n=h+l,w=c,t=0,v=o.position().top,y=o.outerHeight();n>v+y?n=v+y:u.show();f.show();p=f.outerWidth();t=a/2-p/2;f.css({top:n+5,left:w,"margin-left":t});t<0?(f.css("margin-left","0"),s.hide()):s.show();r.disableMenusExcept()}}function e(){i!=null&&(i.removeClass("clicked"),i=null,f.hide(),u.hide(),r.enableMenusExcept())}function rt(n){var i=!1;return t.each(it,function(r,u){var f=!1;return t.each(u.imgs,function(t,r){if(n===r)return i=!0,f=!0,!1}),f?!1:void 0}),i}var r=this,d=r.txt,l=d.$txt,o=r.useMaxHeight?l.parent():l,ut=r.$editorContainer,i,a=!1,u=t('<div class="img-drag-point"><\/div>'),f=t('<div class="txt-toolbar"><\/div>'),s=t('<div class="tip-triangle"><\/div>'),v=t('<a href="#"><i class="wangeditor-menu-img-trash-o"><\/i><\/a>'),y=t('<a href="#"><i class="wangeditor-menu-img-search-minus"><\/i><\/a>'),p=t('<a href="#"><i class="wangeditor-menu-img-search-plus"><\/i><\/a>'),w=t('<a href="#"><i class="wangeditor-menu-img-align-left"><\/i><\/a>'),b=t('<a href="#"><i class="wangeditor-menu-img-align-center"><\/i><\/a>'),k=t('<a href="#"><i class="wangeditor-menu-img-align-right"><\/i><\/a>'),h=!1,it=r.config.emotions;o.on("mousedown","img",function(n){n.preventDefault()}).on("click","img",function(n){var r=t(n.currentTarget),u=r.attr("src");if(u&&!rt(u)){if(g(),i&&i.get(0)===r.get(0)){setTimeout(e,100);return}i=r;c();n.preventDefault();n.stopPropagation()}}).on("click keypress scroll",function(){h||setTimeout(e,100)})})}),t(function(n){n.plugin(function(){var t=this,u=t.config.menuFixed,r;if(u!==!1&&typeof u=="number"){r=parseFloat(n.$body.css("margin-top"),10);isNaN(r)&&(r=0);var f=t.$editorContainer,s=f.offset().top,h=f.outerHeight(),i=t.menuContainer.$menuContainer,c=i.css("position"),l=i.css("top"),e,o=i.outerHeight(),a=i.offset().top,v=t.txt.$txt;n.$window.scroll(function(){if(!t.isFullScreen){e=i.width();var f=n.$window.scrollTop();f>=a&&f+u+o+30<s+h?(i.css({position:"fixed",top:u}),i.width(e),n.$body.css({"margin-top":r+o}),t._isMenufixed||(t._isMenufixed=!0)):(i.css({position:c,top:l}),i.css("width","100%"),n.$body.css({"margin-top":r}),t._isMenufixed&&(t._isMenufixed=!1))}})}})}),t(function(n,t){n.createMenu(function(i){var f="indent",r,u;i(f)&&(r=this,u=new n.Menu({editor:r,id:f,title:"缩进",$domNormal:t('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-indent-left"><\/i><\/a>'),$domSelected:t('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-indent-left"><\/i><\/a>')}),u.clickEvent=function(n){function e(){u.css("text-indent","2em")}var f=r.getRangeElem(),i=r.getSelfOrParentByName(f,"p"),u;if(!i)return n.preventDefault();u=t(i);r.customCommand(n,e)},u.clickEventSelected=function(n){function e(){u.css("text-indent","0")}var f=r.getRangeElem(),i=r.getSelfOrParentByName(f,"p"),u;if(!i)return n.preventDefault();u=t(i);r.customCommand(n,e)},u.updateSelectedEvent=function(){var f=r.getRangeElem(),i=r.getSelfOrParentByName(f,"p"),u,n;return i?(u=t(i),n=u.css("text-indent"),!n||n==="0px")?!1:!0:!1},r.menus[f]=u)})}),t(function(n,t){n.createMenu(function(i){var u="lineheight",r;if(i(u)){r=this;r.commandHooks.lineHeight=function(n){var u=r.getRangeElem(),i=r.getSelfOrParentByName(u,"p,h1,h2,h3,h4,h5,pre");i&&t(i).css("line-height",n+"")};var f=new n.Menu({editor:r,id:u,title:"行高",commandName:"lineHeight",$domNormal:t('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-arrows-v"><\/i><\/a>'),$domSelected:t('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-arrows-v"><\/i><\/a>')});f.dropList=new n.DropList(r,f,{data:{"1.0":"1.0倍","1.5":"1.5倍","1.8":"1.8倍","2.0":"2.0倍","2.5":"2.5倍","3.0":"3.0倍"},tpl:'<span style="line-height:{#commandValue}">{#title}<\/span>'});r.menus[u]=f}})}),t(function(n,t){n.plugin(function(){var i=this,o=i.config.customUpload,r,u,f,e;if(o){if(i.config.uploadImgUrl){alert("自定义上传无效，详看浏览器日志console.log");n.error("已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。");return}}else return;r=i.$uploadContent;r||n.error("自定义上传，无法获取 editor.$uploadContent");u=t('<a href="#" class="upload-icon-container"><i class="wangeditor-menu-img-upload"><\/i><\/a>');r.append(u);f="upload"+n.random();e="upload"+n.random();u.attr("id",f);r.attr("id",e);i.customUploadBtnId=f;i.customUploadContainerId=e})}),t(function(n){n.info("本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ")}),window.wangEditor});
//# sourceMappingURL=wangEditor.min.js.map
