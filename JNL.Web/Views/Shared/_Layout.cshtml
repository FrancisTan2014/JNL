<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>

    <link rel="stylesheet" href="/node_modules/materialize-css/dist/css/materialize.min.css"/>
    <link href="/Content/loading-animate.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/Content/parsley.css" />

    <link href="/Content/index.css" rel="stylesheet" />
    <link href="/Content/header.css" rel="stylesheet"/>

    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/node_modules/materialize-css/dist/js/materialize.min.js"></script>
    <script src="/node_modules/parsleyjs/dist/parsley.min.js"></script>
    <script src="/bower_components/jquery-validation/dist/jquery.validate.min.js"></script>

    <script src="/Scripts/page-scripts/common.js"></script>
</head>
<body>
    <div class="body">
        <div id="loader-wrapper">
            <div id="loader"></div>
            <div class="loader-section section-left"></div>
            <div class="loader-section section-right"></div>
        </div>

        <div class="navbar-fixed">
            <nav>
                <div class="nav-wrapper">
                    <a href="javascript:void(0);" class="brand-logo right">Logo</a>
                    <ul id="nav-mobile" class="hide-on-med-and-down">
                        <li class="first-menu">
                            <a href="/Home/Index" class="waves-effect waves-block waves-light">首 页</a>
                        </li>
                        <li class="first-menu">
                            <a class="dropdown-button waves-effect waves-block waves-light" href="javascript:void(0);" data-activates="dropdown1">基础管理</a>
                            <ul id="dropdown1" class="dropdown-content">
                                <li class="second-menu" data-target="#target1" id="techFiles"><a href="javascript:void(0);">技术规章<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
                                <li class="second-menu" data-target="#target2" id="companyFiles"><a href="javascript:void(0);">企业标准<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
                                <li class="second-menu" data-target="#target3" id="methodFiles"><a href="javascript:void(0);">制度措施<i class="mdi-hardware-keyboard-arrow-right right"></i></a></li>
                                <li class="divider"></li>
                                <li><a href="/Basic/Accidents">典型事故</a></li>
                            </ul>
                        </li>
                        <li class="first-menu">
                            <a class="dropdown-button waves-effect waves-block waves-light" href="javascript:void(0);" data-activates="dropdown2">风险信息</a>
                            <ul id="dropdown2" class="dropdown-content">
                                <li>
                                    <a href="#!">安全管理信息中心</a>
                                </li>
                                <li><a href="#!">安全信息分析中心</a></li>
                                <li><a href="#!">机车质量跟踪系统填报</a></li>
                            </ul>
                        </li>
                        <li class="first-menu">
                            <a class="dropdown-button waves-effect waves-block waves-light" href="javascript:void(0);" data-activates="dropdown3">后台管理</a>
                            <ul id="dropdown3" class="dropdown-content">
                                <li><a href="/Basic/AddFile">基础文件上传</a></li>
                                <li><a href="/Basic/AddAccident">添加典型事故</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <ul id="target1" data-source="#techFiles" class="dropdown-content third-menu">
                    <li class="third-menu-item"><a href="/Basic/Files/1/1">总公司</a></li>
                    <li class="third-menu-item"><a href="/Basic/Files/1/2">铁路局</a></li>
                    <li class="third-menu-item"><a href="/Basic/Files/1/3">机务段</a></li>
                </ul>
                <ul id="target2" data-source="#companyFiles" class="dropdown-content third-menu">
                    <li class="third-menu-item"><a href="/Basic/Files/2/1">总公司</a></li>
                    <li class="third-menu-item"><a href="/Basic/Files/2/2">铁路局</a></li>
                    <li class="third-menu-item"><a href="/Basic/Files/2/3">机务段</a></li>
                </ul>
                <ul id="target3" data-source="#methodFiles" class="dropdown-content third-menu">
                    <li class="third-menu-item"><a href="/Basic/Files/3/1">总公司</a></li>
                    <li class="third-menu-item"><a href="/Basic/Files/3/2">铁路局</a></li>
                    <li class="third-menu-item"><a href="/Basic/Files/3/3">机务段</a></li>
                </ul>
            </nav>
        </div>

        <div id="content">
            @RenderBody()
        </div>
    </div>

    <script>
        $(function () {
            // 关闭加载动画
            $('#loader-wrapper').parent().addClass('loaded');

            // 菜单选中状态
            $('nav a').each(function() {
                var href = $(this).prop('href');
                if (location.href.indexOf(href) >= 0) {
                    var $parent = $(this).parent();
                    if ($parent.hasClass('first-menu')) {
                        $parent.addClass('active');
                    } else if ($parent.hasClass('second-menu')) {
                        $parent.parents('.first-menu').addClass('active');
                    } else {
                        $parent.hasClass('third-menu-item');
                        $($(this).data('source')).parents('.first-menu').addClass('active');
                    }
                }
            });

            // 初始化material_select
            $('select').not('.disabled').material_select();
        });

        var initDropdown = function () {
            $('.dropdown-button').dropdown({
                inDuration: 300,
                outDuration: 225,
                constrain_width: false, // Does not change width of dropdown to that of the activator
                hover: true, // Activate on hover
                gutter: 0, // Spacing from edge
                belowOrigin: true // Displays dropdown below the button
            });
        };
        initDropdown();

        $('.second-menu').on('mouseenter', function () {
            var $target = $($(this).data('target'));
            var top = this.offsetParent.offsetTop;
            var left = this.offsetParent.offsetLeft + this.offsetParent.offsetParent.offsetLeft + this.clientWidth;
            $target.css({ top: top, left: left, display: 'block' }).animate({ 'opacity': 1 }, 223);

            $(this).addClass('active');
        }).on('mouseleave', function (e) {
            var $target = $($(this).data('target'));
            var minY = parseInt($target.css('top'));
            var minX = parseInt($target.css('left'));
            var maxY = minY + $target[0].clientHeight;
            var maxX = minX + $target[0].clientWidth;

            if (e.pageX >= minX && e.pageX <= maxX && e.pageY >= minY && e.pageY <= maxY) {
                return false;
            } else {
                $target.hide();
                $(this).removeClass('active');
            }
        });

        $('.third-menu').on('mouseleave', function () {
            $(this).hide();
            $('.second-menu').parent().css({ 'display': 'none' });

            initDropdown();
        });
    </script>
</body>
</html>
